<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>wifi摄像头模块：ESP32-CAM &mdash; OpenXLabEdu  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=b3ba4146"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="深度学习知识库" href="../dl_library.html" />
    <link rel="prev" title="Web库Gradio" href="gradio.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            OpenXLabEdu
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">目录</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../about.html">关于XEdu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../how_to_quick_start.html">XEdu快速入门手册</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../xedu_hub.html">深度学习工具库XEduHub</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mmedu.html">计算机视觉库MMEdu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../basenn.html">神经网络库BaseNN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../baseml.html">传统机器学习库BaseML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../easydl.html">EasyDL系列无代码工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../basedt.html">数据处理库BaseDT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../basedeploy.html">模型部署库BaseDeploy</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../how_to_use.html">如何用XEdu借助AI解决真实问题</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction.html">用AI解决真实问题的技术地图</a></li>
<li class="toctree-l2"><a class="reference internal" href="../step.html">用AI解决问题的一般步骤</a></li>
<li class="toctree-l2"><a class="reference internal" href="../support_resources.html">学习支持和资源获取</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../scitech_tools.html">相关科创工具</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="data_labeling.html">数据集标注工具</a></li>
<li class="toctree-l3"><a class="reference internal" href="pywebio.html">Web库PyWebIO</a></li>
<li class="toctree-l3"><a class="reference internal" href="pysimplegui.html">GUI库PySimpleGUI</a></li>
<li class="toctree-l3"><a class="reference internal" href="siot.html">MQTT库siot</a></li>
<li class="toctree-l3"><a class="reference internal" href="pinpong.html">开源硬件库pinpong</a></li>
<li class="toctree-l3"><a class="reference internal" href="unihiker.html">开源硬件行空板</a></li>
<li class="toctree-l3"><a class="reference internal" href="flask.html">Web库Flask</a></li>
<li class="toctree-l3"><a class="reference internal" href="fastapi.html">Web库FastAPI</a></li>
<li class="toctree-l3"><a class="reference internal" href="gradio.html">Web库Gradio</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">wifi摄像头模块：ESP32-CAM</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">1.简介</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id2">2.简单使用教程</a></li>
<li class="toctree-l4"><a class="reference internal" href="#python">3.简单应用：在Python中测试实时视频流</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../dl_library.html">深度学习知识库</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">OpenXLabEdu</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../how_to_use.html">如何用XEdu借助AI解决真实问题</a></li>
          <li class="breadcrumb-item"><a href="../scitech_tools.html">相关科创工具</a></li>
      <li class="breadcrumb-item active">wifi摄像头模块：ESP32-CAM</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/how_to_use/scitech_tools/camera.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="wifi-esp32-cam">
<h1>wifi摄像头模块：ESP32-CAM<a class="headerlink" href="#wifi-esp32-cam" title="Permalink to this heading"></a></h1>
<section id="id1">
<h2>1.简介<a class="headerlink" href="#id1" title="Permalink to this heading"></a></h2>
<p>ESP32-CAM是一个小巧但功能强大的摄像头模块，非常适合DIY爱好者和科创项目。它可以连接Wi-Fi和蓝牙，让你轻松地进行图像捕获和视频流处理。无论你是想做一个智能小车，还是想在家里安装一个简易的监控系统，ESP32-CAM都是一个很好的选择。</p>
<p>网上有多种配置教程，下文简单介绍一种配置ESP32-CAM的方式以及简单应用【注：不同配置方式涉及的库及使用方法会略有不同】。</p>
</section>
<section id="id2">
<h2>2.简单使用教程<a class="headerlink" href="#id2" title="Permalink to this heading"></a></h2>
<section id="esp32-cam">
<h3>第一步：购买ESP32-CAM<a class="headerlink" href="#esp32-cam" title="Permalink to this heading"></a></h3>
<p>a.在淘宝、京东查找ESP32-CAM，购买一款合适的产品。</p>
<p>b.核对规格：确保购买的是ESP32-CAM模块，它通常包括一个小型摄像头模块（摄像头模块可能需要自行安装）。</p>
<p>c.USB接口的线，配合ESP32-CAM连接。</p>
<p>注：不同型号的配置方式也可能有所不同，本教程适用的ESP32-CAM如下图所示。</p>
<p><img alt="../../_images/cam_1.png" src="../../_images/cam_1.png" /></p>
</section>
<section id="id3">
<h3>第二步：准备编程环境<a class="headerlink" href="#id3" title="Permalink to this heading"></a></h3>
<p>a.下载并安装arduino IDE</p>
<p>这是一个编程软件，可以让你给ESP32-CAM编写和上传代码。</p>
<p>下载地址：<a class="reference external" href="https://www.arduino.cc/en/Main/Software?setlang=cn">https://www.arduino.cc/en/Main/Software?setlang=cn</a></p>
<p>b.下载完成后打开arduino IDE选择首选项</p>
<p><img alt="../../_images/cam0.PNG" src="../../_images/cam0.PNG" /></p>
<p>打开配置后，添加附加开发板管理器网址（可直接复制下面的网址）</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">dl</span><span class="o">.</span><span class="n">espressif</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">dl</span><span class="o">/</span><span class="n">package_esp32_index</span><span class="o">.</span><span class="n">json</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">arduino</span><span class="o">.</span><span class="n">esp8266</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">stable</span><span class="o">/</span><span class="n">package_esp8266com_index</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p><img alt="../../_images/cam2.PNG" src="../../_images/cam2.PNG" /></p>
<p>c.打开工具-开发板管理器，然后搜索esp32</p>
<p><img alt="../../_images/cam3.PNG" src="../../_images/cam3.PNG" /></p>
<p>选第二个esp32 by Espressif点击安装，等待安装完毕</p>
<p><img alt="../../_images/cam4.png" src="../../_images/cam4.png" /></p>
<p>如因网速原因安装较慢可使用离线方法，相关文件和安装方法已上传百度云盘。</p>
<p>链接：<a class="reference external" href="https://pan.baidu.com/s/1T2vqBC2903NnPU-Cv-Qolw">https://pan.baidu.com/s/1T2vqBC2903NnPU-Cv-Qolw</a>
提取码：bpri</p>
</section>
<section id="id4">
<h3>第三步：连接ESP32-CAM至电脑<a class="headerlink" href="#id4" title="Permalink to this heading"></a></h3>
<p>将ESP32-CAM模块通过转换器连接到电脑，并在arduino ide中选择连接，工具-开发板-ESP32-esp32 Wrover Module【上一步顺利完成此步骤才会出现此选项】</p>
<p><img alt="../../_images/cam5.png" src="../../_images/cam5.png" /></p>
<p>工具-端口选择COM5，如果无法识别，可能需要安装对应的COM驱动，如<a class="reference external" href="https://aicarrier.feishu.cn/file/TyjOboEQSoQlXXx5fA7cNobknte">CH341SER.EXE</a>。</p>
<p><img alt="../../_images/cam6.png" src="../../_images/cam6.png" /></p>
</section>
<section id="wifi">
<h3>第四步：编写配置WIFI的代码<a class="headerlink" href="#wifi" title="Permalink to this heading"></a></h3>
<p>a.获取编程示例</p>
<p>ESP32 CAM Live Video Streaming in Python OpenCV的示例代码是：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#include &lt;WebServer.h&gt;
#include &lt;WiFi.h&gt;
#include &lt;esp32cam.h&gt;
 
const char* WIFI_SSID = &quot;请写入你的WIFI账号&quot;; 
const char* WIFI_PASS = &quot;请写入你的WIFI密码&quot;;
 
WebServer server(80);
 
 
static auto loRes = esp32cam::Resolution::find(320, 240);
static auto midRes = esp32cam::Resolution::find(350, 530);
static auto hiRes = esp32cam::Resolution::find(800, 600);
void serveJpg()
{
  auto frame = esp32cam::capture();
  if (frame == nullptr) {
    Serial.println(&quot;CAPTURE FAIL&quot;);
    server.send(503, &quot;&quot;, &quot;&quot;);
    return;
  }
  Serial.printf(&quot;CAPTURE OK %dx%d %db\n&quot;, frame-&gt;getWidth(), frame-&gt;getHeight(),
                static_cast&lt;int&gt;(frame-&gt;size()));
 
  server.setContentLength(frame-&gt;size());
  server.send(200, &quot;image/jpeg&quot;);
  WiFiClient client = server.client();
  frame-&gt;writeTo(client);
}
 
void handleJpgLo()
{
  if (!esp32cam::Camera.changeResolution(loRes)) {
    Serial.println(&quot;SET-LO-RES FAIL&quot;);
  }
  serveJpg();
}
 
void handleJpgHi()
{
  if (!esp32cam::Camera.changeResolution(hiRes)) {
    Serial.println(&quot;SET-HI-RES FAIL&quot;);
  }
  serveJpg();
}
 
void handleJpgMid()
{
  if (!esp32cam::Camera.changeResolution(midRes)) {
    Serial.println(&quot;SET-MID-RES FAIL&quot;);
  }
  serveJpg();
}
 
 
void  setup(){
  Serial.begin(115200);
  Serial.println();
  {
    using namespace esp32cam;
    Config cfg;
    cfg.setPins(pins::AiThinker);
    cfg.setResolution(hiRes);
    cfg.setBufferCount(2);
    cfg.setJpeg(80);
 
    bool ok = Camera.begin(cfg);
    Serial.println(ok ? &quot;CAMERA OK&quot; : &quot;CAMERA FAIL&quot;);
  }
  WiFi.persistent(false);
  WiFi.mode(WIFI_STA);
  WiFi.begin(WIFI_SSID, WIFI_PASS);
  while (WiFi.status() != WL_CONNECTED) {
    delay(500);
  }
  Serial.print(&quot;http://&quot;);
  Serial.println(WiFi.localIP());
  Serial.println(&quot;  /cam-lo.jpg&quot;);
  Serial.println(&quot;  /cam-hi.jpg&quot;);
  Serial.println(&quot;  /cam-mid.jpg&quot;);
 
  server.on(&quot;/cam-lo.jpg&quot;, handleJpgLo);
  server.on(&quot;/cam-hi.jpg&quot;, handleJpgHi);
  server.on(&quot;/cam-mid.jpg&quot;, handleJpgMid);
 
  server.begin();
}
 
void loop()
{
  server.handleClient();
}
</pre></div>
</div>
<p>b.新建文件，将上述代码复制到新文件中，编写Wi-Fi代码，包括指定Wi-Fi账号和密码（第五、六行代码WIFI_SSID和WIFI_PASS），其他不变。【注意：此时先不要上传代码】</p>
</section>
<section id="esp32cam">
<h3>第五步：安装esp32cam库<a class="headerlink" href="#esp32cam" title="Permalink to this heading"></a></h3>
<p>a.下载esp32cam库</p>
<p>下载地址：<a class="reference external" href="https://github.com/yoursunny/esp32cam">https://github.com/yoursunny/esp32cam</a></p>
<p><img alt="../../_images/cam7.png" src="../../_images/cam7.png" /></p>
<p>b.导入库</p>
<p>项目-导入库-添加.ZIP库</p>
<p><img alt="../../_images/cam8.png" src="../../_images/cam8.png" /></p>
</section>
<section id="ip">
<h3>第六步：上传代码并获取IP地址<a class="headerlink" href="#ip" title="Permalink to this heading"></a></h3>
<p>单击上传按钮上传代码</p>
<p><img alt="../../_images/cam9.png" src="../../_images/cam9.png" /></p>
<p>上传代码后点击esp32cam的reset键，重启esp32cam，可打开串口监视器，查看上传代码的运行情况(示例代码会输出相关ip和路径)</p>
<p><img alt="../../_images/cam10.png" src="../../_images/cam10.png" /></p>
<p>下图中是串口监视器里输出的结果（如没有输出可增大默认的波特率）</p>
<p><img alt="../../_images/cam11.png" src="../../_images/cam11.png" /></p>
<p>可以发现在串行监视器的IP地址下，会看到三种不同的图像分辨率 lo、hi 和 mid，根据需求使用一个。</p>
<p>例如我们可以使用http://192.168.31.75/240x240.jpg，使用浏览器打开即可看到摄像头拍摄的照片，手动刷新可以看到拍摄到的一张张照片。</p>
<p>也可以用下面的python代码来查看串口输出的IP信息。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">这段代码不需要理解</span>
<span class="sd">仅用作读取摄像头配置信息</span>

<span class="sd">1.连接摄像头数据线到电脑上（驱动）</span>
<span class="sd">2.点击代码运行按钮</span>
<span class="sd">3.点击摄像头上的“EN/RST”</span>

<span class="sd">详解见：https://xedu.readthedocs.io/zh/master/how_to_use/scitech_tools/camera.html</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="kn">import</span> <span class="nn">serial</span>
<span class="kn">import</span> <span class="nn">serial.tools.list_ports</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">find_serial_ports</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">serial</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">list_ports</span><span class="o">.</span><span class="n">comports</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">read_from_port</span><span class="p">(</span><span class="n">ser</span><span class="p">):</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ser</span><span class="o">.</span><span class="n">in_waiting</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># 读取一行，直到遇到换行符</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">ser</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Received: </span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="c1"># 检测所有可用的串口</span>
<span class="n">ports</span> <span class="o">=</span> <span class="n">find_serial_ports</span><span class="p">()</span>
<span class="k">for</span> <span class="n">port_info</span> <span class="ow">in</span> <span class="n">ports</span><span class="p">:</span>
    <span class="n">port</span> <span class="o">=</span> <span class="n">port_info</span><span class="o">.</span><span class="n">device</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Found port: </span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># 尝试打开串口，设置波特率</span>
        <span class="k">with</span> <span class="n">serial</span><span class="o">.</span><span class="n">Serial</span><span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="mi">115200</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="k">as</span> <span class="n">ser</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Opened </span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s1">. Starting to read data...&#39;</span><span class="p">)</span>
            <span class="c1"># 给设备一点时间来初始化</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="c1"># 开始读取数据</span>
            <span class="n">read_from_port</span><span class="p">(</span><span class="n">ser</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">serial</span><span class="o">.</span><span class="n">SerialException</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Cannot open </span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s1">. It might be in use or not available.&#39;</span><span class="p">)</span>
<span class="c1"># 如果没有找到串口，则打印消息</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">ports</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No available serial ports found&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>注：同一个WIFI下IP地址不会发生变化。</p>
</section>
</section>
<section id="python">
<h2>3.简单应用：在Python中测试实时视频流<a class="headerlink" href="#python" title="Permalink to this heading"></a></h2>
<p>由前文可知通过ESP32-CAM获取的是一张照片，如果编写代码一直读就是视频流了。下面这段代码是连接esp32cam摄像头，获取视频流并将图片展示在窗口（需要将代码中的ip改为上述串口监视器中输出的ip）的参考代码。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">import</span> <span class="nn">urllib.request</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://192.168.31.75/240x240.jpg&#39;</span> <span class="c1"># 填写串口监视器中输出的ip地址</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">namedWindow</span><span class="p">(</span><span class="s2">&quot;live Cam Testing&quot;</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">WINDOW_AUTOSIZE</span><span class="p">)</span>

<span class="c1"># 创建VideoCapture对象</span>
<span class="n">cap</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="c1"># 检查是否成功打开摄像头</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">cap</span><span class="o">.</span><span class="n">isOpened</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to open the IP camera stream&quot;</span><span class="p">)</span>
    <span class="n">exit</span><span class="p">()</span>

<span class="c1"># 读取并显示视频帧</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">img_resp</span><span class="o">=</span><span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="c1">#通过URL请求获取一帧图像</span>
    <span class="n">imgnp</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">bytearray</span><span class="p">(</span><span class="n">img_resp</span><span class="o">.</span><span class="n">read</span><span class="p">()),</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span> <span class="c1"># 将获取的图像转换为numpy数组</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imdecode</span><span class="p">(</span><span class="n">imgnp</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># 解码图像</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># 将图像水平翻转，1代表水平翻转</span>
    
    <span class="c1"># 在窗口中显示图像</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;live Cam Testing&#39;</span><span class="p">,</span><span class="n">im</span><span class="p">)</span>
    <span class="n">key</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">key</span><span class="o">==</span><span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">):</span> <span class="c1"># 按q键退出循环</span>
        <span class="k">break</span>
    
<span class="n">cap</span><span class="o">.</span><span class="n">release</span><span class="p">()</span> <span class="c1"># 释放VideoCapture对象</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span> <span class="c1"># 关闭所有OpenCV创建的窗口</span>
</pre></div>
</div>
<p>在此基础上，可继续编写更复杂的python代码，例如对接收的照片进行各种模型推理的操作，甚至还可以连接小车做一个无人行驶小车（例如有人对ESP32-CAM进行了封装组装成了一款JTANK履带车，我们在其基础上制作成了一辆<a class="reference external" href="https://xedu.readthedocs.io/zh/master/xedu_hub/projects.html#id5">识行小车</a>）。</p>
<p>本文参考：<a class="reference external" href="https://www.electroniclinic.com/esp32-cam-with-python-opencv-yolo-v3-for-object-detection-and-identification/">https://www.electroniclinic.com/esp32-cam-with-python-opencv-yolo-v3-for-object-detection-and-identification/</a></p>
<p>借助ESP32-CAM还能连接<a class="reference external" href="https://xedu.readthedocs.io/zh/master/scitech_tools/siot.html">SIOT</a>做各种智联网应用，下面这段代码的主要功能是读取摄像头图片，借助XEduHub完成手部检测，再向MQTT服务器发送消息，在此代码基础上，相信可以做出更多创意应用。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">from</span> <span class="nn">XEdu.hub</span> <span class="kn">import</span> <span class="n">Workflow</span> <span class="k">as</span> <span class="n">wf</span> 
<span class="kn">import</span> <span class="nn">siot</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">urllib.request</span>

<span class="n">SERVER</span> <span class="o">=</span> <span class="s2">&quot;iot.dfrobot.com.cn&quot;</span>            <span class="c1">#MQTT服务器IP</span>
<span class="n">CLIENT_ID</span> <span class="o">=</span> <span class="s2">&quot;1234&quot;</span>                  <span class="c1">#在SIoT上，CLIENT_ID可以留空</span>
<span class="n">IOT_pubTopic</span>  <span class="o">=</span> <span class="s1">&#39;tgzrRLVIg&#39;</span>       <span class="c1">#“topic”为“项目名称/设备名称”</span>
<span class="n">IOT_UserName</span> <span class="o">=</span><span class="s1">&#39;75HzWwL7R&#39;</span>            <span class="c1">#用户名</span>
<span class="n">IOT_PassWord</span> <span class="o">=</span><span class="s1">&#39;ncNkZQL7Rz&#39;</span>         <span class="c1">#密码</span>

<span class="n">siot</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">CLIENT_ID</span><span class="p">,</span><span class="n">SERVER</span><span class="p">,</span><span class="n">user</span><span class="o">=</span><span class="n">IOT_UserName</span><span class="p">,</span><span class="n">password</span><span class="o">=</span><span class="n">IOT_PassWord</span><span class="p">)</span>
<span class="n">siot</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="n">siot</span><span class="o">.</span><span class="n">loop</span><span class="p">()</span>
<span class="n">siot</span><span class="o">.</span><span class="n">publish_save</span><span class="p">(</span><span class="n">IOT_pubTopic</span><span class="p">,</span> <span class="s1">&#39;stop&#39;</span><span class="p">)</span>

<span class="c1">#print(&quot;Before URL&quot;)rtsp://[username]:[password]@192.168.1.64/1&#39;</span>
<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://192.168.31.94/240x240.jpg&#39;</span> 
<span class="n">cap</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="c1"># Check if the IP camera stream is opened successfully</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">cap</span><span class="o">.</span><span class="n">isOpened</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to open the IP camera stream&quot;</span><span class="p">)</span>
    <span class="n">exit</span><span class="p">()</span>

<span class="c1">#print(&quot;After URL&quot;)</span>
<span class="n">model</span><span class="o">=</span><span class="n">wf</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s1">&#39;det_hand&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
<span class="n">last</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">img_resp</span><span class="o">=</span><span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">imgnp</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">bytearray</span><span class="p">(</span><span class="n">img_resp</span><span class="o">.</span><span class="n">read</span><span class="p">()),</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="c1"># 将图像水平翻转</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imdecode</span><span class="p">(</span><span class="n">imgnp</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">r</span><span class="p">,</span><span class="n">img</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">inference</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">frame</span><span class="p">,</span><span class="n">img_type</span><span class="o">=</span><span class="s1">&#39;cv2&#39;</span><span class="p">,</span><span class="n">thr</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s2">&quot;Capturing&quot;</span><span class="p">,</span><span class="n">img</span><span class="p">)</span>
    <span class="c1">#print(&#39;Running..&#39;)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;stop&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;go&#39;</span>
        
    <span class="k">if</span> <span class="n">cmd</span><span class="o">!=</span><span class="n">last</span><span class="p">:</span>
        <span class="n">siot</span><span class="o">.</span><span class="n">publish_save</span><span class="p">(</span><span class="n">IOT_pubTopic</span><span class="p">,</span> <span class="n">cmd</span><span class="p">)</span>
        <span class="n">last</span><span class="o">=</span><span class="n">cmd</span>
    <span class="c1">#sleep(0.1)</span>
    <span class="k">if</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">):</span>
        <span class="k">break</span>

<span class="n">cap</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="gradio.html" class="btn btn-neutral float-left" title="Web库Gradio" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../dl_library.html" class="btn btn-neutral float-right" title="深度学习知识库" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021-2024 OpenXLabEdu.All Rights Reserved.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>