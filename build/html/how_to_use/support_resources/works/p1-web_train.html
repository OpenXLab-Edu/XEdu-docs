<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>项目：在网页上训练一个AI模型并部署 &mdash; OpenXLabEdu  documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js?v=b3ba4146"></script>
        <script src="../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="项目：用XEdu做一个趣味甲骨文学习系统" href="p2-jiaguwen.html" />
    <link rel="prev" title="创意项目展示" href="../creative_works.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            OpenXLabEdu
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">目录</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../about.html">关于XEdu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../xedu_hub.html">深度学习工具库XEduHub</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mmedu.html">计算机视觉库MMEdu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../basenn.html">神经网络库BaseNN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../baseml.html">传统机器学习库BaseML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../easydl.html">EasyDL系列无代码工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../basedt.html">数据处理库BaseDT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../basedeploy.html">模型部署库BaseDeploy</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../how_to_use.html">如何用XEdu借助AI解决真实问题</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../introduction.html">用AI解决真实问题的技术地图</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../step.html">用AI解决问题的一般步骤</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../support_resources.html">学习支持和资源获取</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../model_convert.html">模型转换和应用</a></li>
<li class="toctree-l3"><a class="reference internal" href="../faq.html">常见问题解答</a></li>
<li class="toctree-l3"><a class="reference internal" href="../resources.html">学习资源下载</a></li>
<li class="toctree-l3"><a class="reference internal" href="../courses.html">在线学习课程</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../creative_works.html">创意项目展示</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">项目：在网页上训练一个AI模型并部署</a></li>
<li class="toctree-l4"><a class="reference internal" href="p2-jiaguwen.html">项目：用XEdu做一个趣味甲骨文学习系统</a></li>
<li class="toctree-l4"><a class="reference internal" href="p3-aiot.html">项目：结合SIoT的智能语音识别——让掌控板也能识别语音</a></li>
<li class="toctree-l4"><a class="reference internal" href="p4-smartspeaker.html">项目：让行空板变身为智能音箱</a></li>
<li class="toctree-l4"><a class="reference internal" href="p5-dianlufuhaoshibiexiaozhushou.html">项目：电路符号识别小助手</a></li>
<li class="toctree-l4"><a class="reference internal" href="p6-shitoujiandaobupeiwan.html">项目：设计“石头剪刀布”陪玩机器人</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../scitech_tools.html">相关科创工具</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dl_library.html">深度学习知识库</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">OpenXLabEdu</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../how_to_use.html">如何用XEdu借助AI解决真实问题</a></li>
          <li class="breadcrumb-item"><a href="../../support_resources.html">学习支持和资源获取</a></li>
          <li class="breadcrumb-item"><a href="../creative_works.html">创意项目展示</a></li>
      <li class="breadcrumb-item active">项目：在网页上训练一个AI模型并部署</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/how_to_use/support_resources/works/p1-web_train.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="ai">
<h1>项目：在网页上训练一个AI模型并部署<a class="headerlink" href="#ai" title="Permalink to this heading"></a></h1>
<section id="id1">
<h2>项目背景<a class="headerlink" href="#id1" title="Permalink to this heading"></a></h2>
<p>随着人工智能的发展和普及，深度学习已经成为人工智能的核心内容。越来越多的教育者认识到，不涉及到数据采集、模型训练和部署等内容，几乎不能称之为人工智能教育。为了降低深度学习的技术门槛，一些人工智能学习平台设计了基于Web页面的模型训练功能，即学生不需要编写代码，点点鼠标就能完成从采集数据、训练模型到推理的机器学习流程。我们将这种模型训练方式命名为Web前端模型训练。那么，这种基于网页前端训练出来的AI模型，能不能像其他模型一样，也可以部署到开源硬件，搭建出一个真正的AI应用？为此，我们对这个问题进行了深度探究，并成功实现了将一个通过Web前端训练对AI模型，转换为ONNX并部署到行空板上。</p>
</section>
<section id="id2">
<h2>一、收集数据训练模型（含图片上传）<a class="headerlink" href="#id2" title="Permalink to this heading"></a></h2>
<p>提供了Web前端模型训练功能的国内人工智能学习平台，主要有浦育、英荔和腾讯扣叮这几类。在Web前端训练一个AI模型的流程，和常见的机器学习流程是一致的，都要经历数据采集、模型训练和模型推理这三个环节，如图所示。</p>
<p><img alt="../../../_images/web.PNG" src="../../../_images/web.PNG" /></p>
<p>相对而言，浦育平台（OpenInnoLab）在TensorFlow.js的基础上做了二次开发，功能最为强大。其不仅实现了模型训练和推理演示，还与积木编程无缝融合，学生可以将模型推理结果应用在类似Scratch的编程上，与舞台上的各种角色互动。而英荔平台似乎是谷歌Teachable Machine的镜像网站，除了在线训练模型外，还能够下载训练好模型，并且提供了TensorFlow.js模型和h5模型（Keras框架使用的模型）的转换。</p>
<p>经过分析，通过TensorFlow.js训练的图像分类模型，采用的算法是谷歌团队提出的MobileNet v2。MobileNets系列的本身初衷是” for Mobile Vision Applications”，是一个轻量化的卷积网络模型，可以显著减少计算量和参数量，同时保持较高的准确率来提升效率，能够运行在算力不太高的移动设备上。</p>
</section>
<section id="id3">
<h2>二、下载并转换模型<a class="headerlink" href="#id3" title="Permalink to this heading"></a></h2>
<p>虽然英荔平台提供了h5格式的模型下载，而类似树莓派、行空板的开源硬件也能够安装Keras的环境，似乎看起来部署模型很简单。实际上h5模型的加载实在太慢了，一个简单的图像分类模型居然要2分钟才能完成，推理速度也很慢。我们在《当MMEdu遇上行空板——“智能稻草人”项目的后续研究》一文中，已经给出了在行空板上部署ONNX模型的方法。于是，我们在万能的GitHub找到了一个名为“tf2onnx”的库，先将h5模型转换为ONNX模型，然后部署在行空板上。</p>
<p>tf2onnx是一个将TensorFlow（tf-1.x或tf-2.x）、keras、tensorflow.js和tflite模型转换为ONNX的工具库，可通过命令行或Python API进行操作。安装tf2onnx库的同时，还需要部署好tensorflowjs的环境。安装过程有点长，具体安装时间受制于网络速度。</p>
<p>tf2onnx提供了多种转换方式。最方便的是调用命令行，参考命令如“python -m tf2onnx.convert –saved-model tensorflow-model-path –output model.onnx”。也可以调用Python API来完成转换，核心代码并不复杂，十来行代码即可完成。参考代码如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">import</span> <span class="nn">tf2onnx</span>
 
<span class="n">graph_def</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">GraphDef</span><span class="p">()</span>
<span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">gfile</span><span class="o">.</span><span class="n">GFile</span><span class="p">(</span><span class="s1">&#39;input.pb&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">graph_def</span><span class="o">.</span><span class="n">ParseFromString</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
 
<span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">import_graph_def</span><span class="p">(</span><span class="n">graph_def</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">graph</span>
    <span class="n">onnx_model</span> <span class="o">=</span> <span class="n">tf2onnx</span><span class="o">.</span><span class="n">convert</span><span class="o">.</span><span class="n">from_session</span><span class="p">(</span><span class="n">sess</span><span class="p">,</span> <span class="n">input_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;input:0&#39;</span><span class="p">],</span> <span class="n">output_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;output:0&#39;</span><span class="p">])</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;output.onnx&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">onnx_model</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">())</span>
</pre></div>
</div>
<p>具体转换流程如下：首先要将Web前端训练的模型下载到本地。下载的模型文件为一个压缩包，解压后可得到model.json和model.weights.bin两个文件。转换时，这两个文件要放在一个文件夹中。为了方便大家使用，我们在浦育平台上建了一个公开项目，只要将模型文件上传到平台，点击项目中的main.ipynb文件，并依次运行代码，不用修改任何路径，报成功转换后即表示运行成功。</p>
<p>参考项目：<a class="reference external" href="https://openinnolab.org.cn/pjlab/project?id=645ddb8fd73dd91bcbf15083&amp;sc=635638d69ed68060c638f979#public">https://openinnolab.org.cn/pjlab/project?id=645ddb8fd73dd91bcbf15083&amp;sc=635638d69ed68060c638f979#public</a></p>
</section>
<section id="python">
<h2>三、用Python编程完成模型推理<a class="headerlink" href="#python" title="Permalink to this heading"></a></h2>
<section id="xeduhub">
<h3>方式一：借助XEduHub<a class="headerlink" href="#xeduhub" title="Permalink to this heading"></a></h3>
<p>转换生成的ONNX模型可借助XEdu团队的XEduHub完成推理，参考代码如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">XEdu.hub</span> <span class="kn">import</span> <span class="n">Workflow</span> <span class="k">as</span> <span class="n">wf</span>
<span class="n">mmcls</span> <span class="o">=</span> <span class="n">wf</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s1">&#39;mmedu&#39;</span><span class="p">,</span><span class="n">checkpoint</span><span class="o">=</span><span class="s1">&#39;model.onnx&#39;</span><span class="p">)</span><span class="c1"># 指定使用的onnx模型</span>
<span class="n">result</span><span class="p">,</span> <span class="n">result_img</span> <span class="o">=</span>  <span class="n">mmcls</span><span class="o">.</span><span class="n">inference</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;test/0.png&#39;</span><span class="p">,</span><span class="n">img_type</span><span class="o">=</span><span class="s1">&#39;pil&#39;</span><span class="p">)</span><span class="c1"># 进行模型推理</span>
<span class="n">format_result</span> <span class="o">=</span> <span class="n">mmcls</span><span class="o">.</span><span class="n">format_output</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s2">&quot;zh&quot;</span><span class="p">)</span><span class="c1"># 推理结果格式化输出</span>
<span class="n">mmcls</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">result_img</span><span class="p">)</span><span class="c1"># 展示推理结果图片</span>
</pre></div>
</div>
</section>
<section id="basedeploy">
<h3>方式二：借助BaseDeploy<a class="headerlink" href="#basedeploy" title="Permalink to this heading"></a></h3>
<p>还有第二种推理方式，是借助XEdu团队的BaseDeploy库完成，参考代码如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">BaseDeploy</span> <span class="k">as</span> <span class="nn">bd</span>
<span class="n">model_path</span> <span class="o">=</span> <span class="s1">&#39;model.onnx&#39;</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">bd</span><span class="p">(</span><span class="n">model_path</span><span class="p">)</span>
<span class="n">img</span> <span class="o">=</span> <span class="s1">&#39;test/0.png&#39;</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">inference</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">print_result</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<p>两种方式都兼容，方式二的最大优势见下文。</p>
</section>
</section>
<section id="mind">
<h2>四、用mind积木编程完成模型推理<a class="headerlink" href="#mind" title="Permalink to this heading"></a></h2>
<p>DFRobot的工程团队为BaseDeploy库设计了积木块，代表我们可以使用mind积木编程完成模型推理。</p>
<p>首先安装库：BaseDeploy</p>
<p><img alt="../../../_images/install.png" src="../../../_images/install.png" /></p>
<p>然后加载积木块：切换至“模块”编程—打开扩展—选择用户库—输入库链接—加载积木库。</p>
<p>库链接：<a class="reference external" href="https://gitee.com/liliang9693/ext-BaseDeploy">https://gitee.com/liliang9693/ext-BaseDeploy</a></p>
<p><img alt="../../../_images/bd.png" src="../../../_images/bd.png" /></p>
<p>最后编写程序，填写模型名称，将图片传入进行推理仅需4个积木块即可完成（程序里面需要资源文件需先上传）。</p>
<p><img alt="../../../_images/bd2.png" src="../../../_images/bd2.png" /></p>
<p>模型该如何上传到行空板上？打开<strong>文件系统</strong>，将文件拖入<strong>项目中的文件</strong>即可，在点击<strong>运行</strong>的时候Mind+会将<strong>项目中的文件</strong>里面的所有文件一起上传到行空板的mindplus文件夹中运行。</p>
</section>
<section id="id4">
<h2>五、在行空板上部署模型<a class="headerlink" href="#id4" title="Permalink to this heading"></a></h2>
<p>最后，我们可以连接行空板，只需将ONNX模型上传行空板，再编写推理代码，就可实现将模型部署到行空板上，简单操作可查看<a class="reference external" href="https://xedu.readthedocs.io/zh/master/support_resources/model_convert.html#id11">部署模型到硬件的教程</a>。</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../creative_works.html" class="btn btn-neutral float-left" title="创意项目展示" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="p2-jiaguwen.html" class="btn btn-neutral float-right" title="项目：用XEdu做一个趣味甲骨文学习系统" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021-2024 OpenXLabEdu.All Rights Reserved.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>