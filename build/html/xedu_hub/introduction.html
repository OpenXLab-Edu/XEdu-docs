<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>XEduHub功能详解 &mdash; OpenXLabEdu  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=b3ba4146"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="XEduHub项目案例集" href="projects.html" />
    <link rel="prev" title="XEduHub安装" href="installation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            OpenXLabEdu
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">目录</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../about.html">关于XEdu</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../xedu_hub.html">深度学习工具库XEduHub</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="quick_start.html">快速体验XEduHub</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html">XEduHub安装</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">XEduHub功能详解</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#workflow">什么是Workflow？</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#a-href-https-www-openinnolab-org-cn-pjlab-project-id-65518e1ae79a38197e449843-backpath-pjlab-projects-list-public-xeduhub-a">强烈安利项目<a href="https://www.openinnolab.org.cn/pjlab/project?id=65518e1ae79a38197e449843&backpath=/pjlab/projects/list#public">XEduHub实例代码-入门完整版</a></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id1">1. 关键点识别</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id2">人体关键点识别</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id9"><strong>人脸关键点</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="#id16"><strong>人手关键点</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="#id23"><strong>人体所有关键点</strong></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id30">2. 目标检测</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#coco">coco目标检测</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id37">人体检测</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id44">脸部检测</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id51">手部检测</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id58">3. 图像分类</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id59">代码样例</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id60">代码解释</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id64">4. 风格迁移</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id65">代码样例</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id66">代码解释</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#ocr">5. 光学字符识别（OCR）</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id71">代码样例</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id72">代码解释</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id77">6. 全景驾驶感知系统</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id78">代码样例</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id79">代码解释</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#mmedu">7. MMEdu模型推理</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#mmclassification">MMClassification模型</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mmdetection">MMDetection模型</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#basenn">8. BaseNN模型推理</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id96">代码样例</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id97">代码解释</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#baseml">9. BaseML模型推理</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id101">代码样例</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id102">代码解释</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#onnx">10. 其他onnx模型推理</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id106">代码样例</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id107">代码解释</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id110">报错专栏</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="projects.html">XEduHub项目案例集</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../mmedu.html">计算机视觉库MMEdu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basenn.html">神经网络库BaseNN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../baseml.html">传统机器学习库BaseML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../easydl.html">EasyDL系列无代码工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basedt.html">数据处理库BaseDT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basedeploy.html">模型部署库BaseDeploy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scitech_tools.html">相关科创工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="../support_resources.html">学习支持和资源获取</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dl_library.html">深度学习知识库</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">OpenXLabEdu</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../xedu_hub.html">深度学习工具库XEduHub</a></li>
      <li class="breadcrumb-item active">XEduHub功能详解</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/xedu_hub/introduction.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="xeduhub">
<h1>XEduHub功能详解<a class="headerlink" href="#xeduhub" title="Permalink to this heading"></a></h1>
<section id="workflow">
<h2>什么是Workflow？<a class="headerlink" href="#workflow" title="Permalink to this heading"></a></h2>
<p>我们在使用XEduHub时都需要执行这段代码<code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">XEdu.hub</span> <span class="pre">import</span> <span class="pre">Workflow</span> <span class="pre">as</span> <span class="pre">wf</span></code>。Workflow的基本逻辑是使用训练好的模型对数据进行推理。</p>
<p>那什么是Workflow呢？在使用XEduHub里的单个模型时，Workflow就是模型推理的推理流，从数据，到输入模型，再到输出推理结果。在使用XEduHub里多个模型进行联动时，Workflow可以看做不同模型之间的数据流动，例如首先进行多人的目标检测，将检测到的数据传入关键点识别模型从而对每个人体进行关键点识别。</p>
<p>总之，Workflow里有丰富的深度学习工具，你可以灵活地使用这些工具，根据自身需求，组建属于你自己的Workflow。下面开始介绍Workflow中丰富的深度学习工具。</p>
<section id="a-href-https-www-openinnolab-org-cn-pjlab-project-id-65518e1ae79a38197e449843-backpath-pjlab-projects-list-public-xeduhub-a">
<h3>强烈安利项目<a href="https://www.openinnolab.org.cn/pjlab/project?id=65518e1ae79a38197e449843&backpath=/pjlab/projects/list#public">XEduHub实例代码-入门完整版</a><a class="headerlink" href="#a-href-https-www-openinnolab-org-cn-pjlab-project-id-65518e1ae79a38197e449843-backpath-pjlab-projects-list-public-xeduhub-a" title="Permalink to this heading"></a></h3>
<p><a href="https://www.openinnolab.org.cn/pjlab/project?id=65518e1ae79a38197e449843&backpath=/pjlab/projects/list#public">https://www.openinnolab.org.cn/pjlab/project?id=65518e1ae79a38197e449843&amp;backpath=/pjlab/projects/list#public</a></p>
<p>通过学习“XEduHub实例代码-入门完整版”，可以在项目实践中探索XEduHub的魅力，项目中通俗易懂的讲解和实例代码也能帮助初学者快速入门XEduHub。</p>
</section>
</section>
<section id="id1">
<h2>1. 关键点识别<a class="headerlink" href="#id1" title="Permalink to this heading"></a></h2>
<p>关键点识别是深度学习中的一项关键任务，旨在检测图像或视频中的关键位置，通常代表物体或人体的重要部位。XEduHub支持的关键点识别任务有：人体关键点<code class="docutils literal notranslate"><span class="pre">pose_body</span></code>、人脸关键点<code class="docutils literal notranslate"><span class="pre">pose_face</span></code>、人手关键点<code class="docutils literal notranslate"><span class="pre">pose_hand</span></code>和所有人体关键点识别<code class="docutils literal notranslate"><span class="pre">pose_wholebody</span></code>。</p>
<section id="id2">
<h3>人体关键点识别<a class="headerlink" href="#id2" title="Permalink to this heading"></a></h3>
<p>人体关键点识别是一项计算机视觉任务，旨在检测和定位图像或视频中人体的关键位置，通常是关节、身体部位或特定的解剖结构。</p>
<p>这些关键点的检测可以用于人体姿态估计和分类、动作分析、手势识别等多种应用。</p>
<p>XEduHub提供了两个识别人体关键点的优质模型:<code class="docutils literal notranslate"><span class="pre">pose_body17</span></code>和<code class="docutils literal notranslate"><span class="pre">pose_body26</span></code>，能够在使用cpu推理的情况下，快速识别出身体的关键点。</p>
<p>数字表示了识别出人体关键点的数量。</p>
<p><code class="docutils literal notranslate"><span class="pre">pose_body17</span></code>模型能识别出17个人体骨骼关键点，<code class="docutils literal notranslate"><span class="pre">pose_body26</span></code>模型能识别出26个人体骨骼关键点。</p>
<p><img alt="../_images/body.png" src="../_images/body.png" /></p>
<section id="id3">
<h4>代码样例<a class="headerlink" href="#id3" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">XEdu.hub</span> <span class="kn">import</span> <span class="n">Workflow</span> <span class="k">as</span> <span class="n">wf</span>
<span class="n">body</span> <span class="o">=</span> <span class="n">wf</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s1">&#39;pose_body&#39;</span><span class="p">)</span> <span class="c1"># 数字可省略，当省略时，默认为pose_body17</span>
<span class="n">keypoints</span><span class="p">,</span><span class="n">img_with_keypoints</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">inference</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;data/body.jpg&#39;</span><span class="p">,</span><span class="n">img_type</span><span class="o">=</span><span class="s1">&#39;pil&#39;</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># 进行模型推理</span>
<span class="n">format_result</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">format_output</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;zh&#39;</span><span class="p">)</span><span class="c1"># 将推理结果进行格式化输出</span>
<span class="n">body</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">img_with_keypoints</span><span class="p">)</span><span class="c1"># 展示推理图片</span>
<span class="n">body</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">img_with_keypoints</span><span class="p">,</span><span class="s1">&#39;img_with_keypoints.jpg&#39;</span><span class="p">)</span><span class="c1"># 保存推理图片</span>
</pre></div>
</div>
</section>
<section id="id4">
<h4>代码解释<a class="headerlink" href="#id4" title="Permalink to this heading"></a></h4>
</section>
<section id="id5">
<h4>1. 模型声明<a class="headerlink" href="#id5" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">XEdu.hub</span> <span class="kn">import</span> <span class="n">Workflow</span> <span class="k">as</span> <span class="n">wf</span>
<span class="n">body</span> <span class="o">=</span> <span class="n">wf</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s1">&#39;pose_body&#39;</span><span class="p">)</span> <span class="c1"># 数字可省略，当省略时，默认为pose_body17</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">wf()</span></code>中共有两个参数可以设置</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">task</span></code>决定了使用哪个关键点识别模型，可选取值为：<code class="docutils literal notranslate"><span class="pre">[pose_body17,pose_body26]</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">download_path</span></code>参数决定了预训练模型下载的路径。默认是下载到同级的checkpoints文件夹中，当代码运行时，会先在本地的同级目录中寻找是否有已下载的预训练模型，如果没有，到本地缓存中寻找，如果本地缓存没有，查看是不是指定了模型的路径，如果都没有，到网络下载。用户也可指定模型的下载路径，如<code class="docutils literal notranslate"><span class="pre">dowload_path='my_checkpoint'</span></code>。</p></li>
</ul>
</section>
<section id="id6">
<h4>2. 模型推理<a class="headerlink" href="#id6" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">keypoints</span><span class="p">,</span><span class="n">img_with_keypoints</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">inference</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;data/body.jpg&#39;</span><span class="p">,</span><span class="n">img_type</span><span class="o">=</span><span class="s1">&#39;pil&#39;</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># 进行模型推理</span>
</pre></div>
</div>
<p><img alt="../_images/body_result.png" src="../_images/body_result.png" /></p>
<p>模型推理<code class="docutils literal notranslate"><span class="pre">inference()</span></code>可传入参数：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">data</span></code>: 指定待识别关键点的图片，可以是以图片路径形式传入，也可直接传入cv2或pil格式的图片。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">show</span></code>: 可取值：<code class="docutils literal notranslate"><span class="pre">[True,False]</span></code> 默认为<code class="docutils literal notranslate"><span class="pre">False</span></code>。如果取值为<code class="docutils literal notranslate"><span class="pre">True</span></code>，在推理完成后会直接输出关键点识别完成后的图片。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">img_type</span></code>: 关键点识别完成后会返回含有关键点的图片，该参数指定了返回图片的格式，可选有:<code class="docutils literal notranslate"><span class="pre">['cv2','pil']</span></code>，默认值为<code class="docutils literal notranslate"><span class="pre">None</span></code>，如果不传入值，则不会返回图。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bbox</span></code>：该参数可配合目标检测使用。在多人关键点检测中，该参数指定了要识别哪个检测框中的关键点。</p></li>
</ul>
<p>模型推理返回结果：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">keypoints</span></code>以二维数组的形式保存了所有关键点的坐标，每个关键点(x,y)被表示为<code class="docutils literal notranslate"><span class="pre">[x,y]</span></code>根据前面的图示，要获取到某个特定序号<code class="docutils literal notranslate"><span class="pre">i</span></code>的关键点，只需要访问<code class="docutils literal notranslate"><span class="pre">keypoints[i]</span></code>即可。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">img_with_keypoints</span></code>是个三维数组，以pil格式保存了关键点识别完成后的图片。</p></li>
</ul>
</section>
<section id="id7">
<h4>3. 结果输出<a class="headerlink" href="#id7" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">format_result</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">format_output</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;zh&#39;</span><span class="p">)</span><span class="c1"># 参数lang设置了输出结果的语言，默认为中文</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">format_output()</span></code>能够将模型推理结果以标准美观的方式进行输出。输出结果与<code class="docutils literal notranslate"><span class="pre">format_result</span></code>保存的内容一致。参数<code class="docutils literal notranslate"><span class="pre">lang</span></code>设置了输出结果的语言，如果不指定默认为中文。</p>
<p><code class="docutils literal notranslate"><span class="pre">format_result</span></code>以字典形式存储了推理结果，共有两个键：<code class="docutils literal notranslate"><span class="pre">关键点坐标</span></code>和<code class="docutils literal notranslate"><span class="pre">分数</span></code>。关键点坐标以二维数组形式保存了每个关键点的[x,y]坐标，而分数则是对应下标的关键点的分数，以一维数组形式保存。</p>
<p><img alt="../_images/body-format.png" src="../_images/body-format.png" /></p>
<p>输出图</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">body</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">img_with_keypoints</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">show()</span></code>能够输出带有关键点和关键点连线的结果图像。</p>
<p><img alt="../_images/body_show.png" src="../_images/body_show.png" /></p>
</section>
<section id="id8">
<h4>4. 结果保存<a class="headerlink" href="#id8" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">body</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">img_with_keypoints</span><span class="p">,</span><span class="s1">&#39;img_with_keypoints.jpg&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">save()</span></code>方法能够保存保存带有关键点和关键点连线结果图像</p>
<p>该方法接收两个参数，一个是图像数据，另一个是图像的保存路径。</p>
</section>
</section>
<section id="id9">
<h3><strong>人脸关键点</strong><a class="headerlink" href="#id9" title="Permalink to this heading"></a></h3>
<p>人脸关键点识别是计算机视觉领域中的一项任务，它的目标是检测和定位人脸图像中代表面部特征的重要点，例如眼睛、鼻子、嘴巴、眉毛等。这些关键点的准确定位对于许多应用非常重要，包括人脸识别、表情分析、虚拟化妆、人机交互等。</p>
<p>XEduHub提供了识别人脸关键点的模型：<code class="docutils literal notranslate"><span class="pre">pose_face106</span></code>，这意味着该模型能够识别人脸上的106个关键点。如下图所示是106个关键点在脸部的分布情况，我们可以利用这些关键点的分布特征进行人脸识别，或者对人的表情进行分析和分类等。</p>
<p><img alt="../_images/new_face106.png" src="../_images/new_face106.png" /></p>
<section id="id10">
<h4>代码样例<a class="headerlink" href="#id10" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">XEdu.hub</span> <span class="kn">import</span> <span class="n">Workflow</span> <span class="k">as</span> <span class="n">wf</span>
<span class="n">face</span> <span class="o">=</span> <span class="n">wf</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s1">&#39;pose_face&#39;</span><span class="p">)</span> <span class="c1"># 数字可省略，当省略时，默认为pose_face106</span>
<span class="n">keypoints</span><span class="p">,</span><span class="n">img_with_keypoints</span> <span class="o">=</span> <span class="n">face</span><span class="o">.</span><span class="n">inference</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;data/face.jpg&#39;</span><span class="p">,</span><span class="n">img_type</span><span class="o">=</span><span class="s1">&#39;pil&#39;</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># 进行模型推理</span>
<span class="n">format_result</span> <span class="o">=</span> <span class="n">face</span><span class="o">.</span><span class="n">format_output</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;zh&#39;</span><span class="p">)</span><span class="c1"># 将推理结果进行格式化输出</span>
<span class="n">face</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">img_with_keypoints</span><span class="p">)</span><span class="c1"># 展示推理图片</span>
<span class="n">face</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">img_with_keypoints</span><span class="p">,</span><span class="s1">&#39;img_with_keypoints.jpg&#39;</span><span class="p">)</span><span class="c1"># 保存推理图片</span>
</pre></div>
</div>
</section>
<section id="id11">
<h4>代码解释<a class="headerlink" href="#id11" title="Permalink to this heading"></a></h4>
</section>
<section id="id12">
<h4>1. 模型声明<a class="headerlink" href="#id12" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">XEdu.hub</span> <span class="kn">import</span> <span class="n">Workflow</span> <span class="k">as</span> <span class="n">wf</span>
<span class="n">face</span> <span class="o">=</span> <span class="n">wf</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s1">&#39;pose_face&#39;</span><span class="p">)</span> <span class="c1"># 数字可省略，默认为face106</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">wf()</span></code>中共有两个参数可以设置</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">task</span></code>决定了使用哪个关键点识别模型，人脸关键点识别模型为<code class="docutils literal notranslate"><span class="pre">pose_face</span></code>。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">download_path</span></code>参数决定了预训练模型下载的路径。默认是下载到同级的checkpoints文件夹中，当代码运行时，会先在本地的同级目录中寻找是否有已下载的预训练模型，如果没有，到本地缓存中寻找，如果本地缓存没有，查看是不是指定了模型的路径，如果都没有，到网络下载。用户也可指定模型的下载路径，如<code class="docutils literal notranslate"><span class="pre">dowload_path='my_checkpoint'</span></code>。</p></li>
</ul>
</section>
<section id="id13">
<h4>2. 模型推理<a class="headerlink" href="#id13" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">keypoints</span><span class="p">,</span><span class="n">img_with_keypoints</span> <span class="o">=</span> <span class="n">face</span><span class="o">.</span><span class="n">inference</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;data/face.jpg&#39;</span><span class="p">,</span><span class="n">img_type</span><span class="o">=</span><span class="s1">&#39;pil&#39;</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># 进行模型推理</span>
</pre></div>
</div>
<p><img alt="../_images/face_result.png" src="../_images/face_result.png" /></p>
<p>模型推理<code class="docutils literal notranslate"><span class="pre">inference()</span></code>可传入参数：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">data</span></code>: 指定待识别关键点的图片，可以是以图片路径形式传入，也可直接传入cv2或pil格式的图片。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">show</span></code>: 可取值：<code class="docutils literal notranslate"><span class="pre">[True,False]</span></code> 默认为<code class="docutils literal notranslate"><span class="pre">False</span></code>。如果取值为<code class="docutils literal notranslate"><span class="pre">True</span></code>，在推理完成后会直接输出关键点识别完成后的图片。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">img_type</span></code>: 关键点识别完成后会返回含有关键点的图片，该参数指定了返回图片的格式，可选有:<code class="docutils literal notranslate"><span class="pre">['cv2','pil']</span></code>，默认值为<code class="docutils literal notranslate"><span class="pre">None</span></code>，如果不传入值，则不会返回图。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bbox</span></code>：该参数可配合目标检测使用。在多人脸关键点检测中，该参数指定了要识别哪个检测框中的关键点。</p></li>
</ul>
<p>模型推理返回结果：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">keypoints</span></code>以二维数组的形式保存了所有关键点的坐标，每个关键点(x,y)被表示为<code class="docutils literal notranslate"><span class="pre">[x,y]</span></code>根据前面的图示，要获取到某个特定序号<code class="docutils literal notranslate"><span class="pre">i</span></code>的关键点，只需要访问<code class="docutils literal notranslate"><span class="pre">keypoints[i]</span></code>即可。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">img_with_keypoints</span></code>是个三维数组，以pil格式保存了关键点识别完成后的图片。</p></li>
</ul>
</section>
<section id="id14">
<h4>3. 结果输出<a class="headerlink" href="#id14" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">format_result</span> <span class="o">=</span> <span class="n">face</span><span class="o">.</span><span class="n">format_output</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;zh&#39;</span><span class="p">)</span><span class="c1"># 将推理结果进行格式化输出</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">format_output()</span></code>能够将模型推理结果以标准美观的方式进行输出。输出结果与<code class="docutils literal notranslate"><span class="pre">format_result</span></code>保存的内容一致。参数<code class="docutils literal notranslate"><span class="pre">lang</span></code>设置了输出结果的语言，如果不指定默认为中文。</p>
<p><code class="docutils literal notranslate"><span class="pre">format_result</span></code>以字典形式存储了推理结果，共有两个键：<code class="docutils literal notranslate"><span class="pre">关键点坐标</span></code>和<code class="docutils literal notranslate"><span class="pre">分数</span></code>。关键点坐标以二维数组形式保存了每个关键点的[x,y]坐标，而分数则是对应下标的关键点的分数，以一维数组形式保存。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">face</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">img_with_keypoints</span><span class="p">)</span><span class="c1"># 展示推理图片</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">show()</span></code>能够输出带有关键点的结果图像。</p>
<p><img alt="../_images/face_show.png" src="../_images/face_show.png" /></p>
</section>
<section id="id15">
<h4>4. 结果保存<a class="headerlink" href="#id15" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">face</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">img_with_keypoints</span><span class="p">,</span><span class="s1">&#39;img_with_keypoints.jpg&#39;</span><span class="p">)</span><span class="c1"># 保存推理图片</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">save()</span></code>方法能够保存带有关键点的图像</p>
<p>该方法接收两个参数，一个是图像数据，另一个是图像的保存路径。</p>
</section>
</section>
<section id="id16">
<h3><strong>人手关键点</strong><a class="headerlink" href="#id16" title="Permalink to this heading"></a></h3>
<p>人手关键点识别是一项计算机视觉任务，其目标是检测和定位图像或视频中人手的关键位置，通常包括手指、手掌、手腕等关键部位的位置。这些关键点的识别对于手势识别、手部姿态估计、手部追踪、手势控制设备等应用具有重要意义。</p>
<p>XEduHub提供了能够快速识别人手关键点的模型：<code class="docutils literal notranslate"><span class="pre">pose_hand21</span></code>，该模型能够识别人手上的21个关键点，如下图所示。你可以根据自身需要对关键点进行进一步处理。例如：手势的不同会体现在关键点位置的分布上，这样就可以利用这些关键点进行手势的分类和识别。</p>
<p><img alt="../_images/new_hand.png" src="../_images/new_hand.png" /></p>
<section id="id17">
<h4>代码样例<a class="headerlink" href="#id17" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">XEdu.hub</span> <span class="kn">import</span> <span class="n">Workflow</span> <span class="k">as</span> <span class="n">wf</span>
<span class="n">hand</span> <span class="o">=</span> <span class="n">wf</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s1">&#39;pose_hand&#39;</span><span class="p">)</span> <span class="c1"># 数字可省略，当省略时，默认为pose_hand21</span>
<span class="n">keypoints</span><span class="p">,</span><span class="n">img_with_keypoints</span> <span class="o">=</span> <span class="n">hand</span><span class="o">.</span><span class="n">inference</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;data/hand.jpg&#39;</span><span class="p">,</span><span class="n">img_type</span><span class="o">=</span><span class="s1">&#39;pil&#39;</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># 进行模型推理</span>
<span class="n">format_result</span> <span class="o">=</span> <span class="n">hand</span><span class="o">.</span><span class="n">format_output</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;zh&#39;</span><span class="p">)</span><span class="c1"># 将推理结果进行格式化输出</span>
<span class="n">hand</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">img_with_keypoints</span><span class="p">)</span><span class="c1"># 展示推理图片</span>
<span class="n">hand</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">img_with_keypoints</span><span class="p">,</span><span class="s1">&#39;img_with_keypoints.jpg&#39;</span><span class="p">)</span><span class="c1"># 保存推理图片</span>
</pre></div>
</div>
</section>
<section id="id18">
<h4>代码解释<a class="headerlink" href="#id18" title="Permalink to this heading"></a></h4>
</section>
<section id="id19">
<h4>1. 模型声明<a class="headerlink" href="#id19" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">XEdu.hub</span> <span class="kn">import</span> <span class="n">Workflow</span> <span class="k">as</span> <span class="n">wf</span>
<span class="n">hand</span> <span class="o">=</span> <span class="n">wf</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s1">&#39;pose_hand&#39;</span><span class="p">)</span> <span class="c1"># 数字可省略，当省略时，默认为pose_hand21</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">wf()</span></code>中共有两个参数可以设置</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">task</span></code>决定了使用哪个关键点识别模型，人手关键点识别模型为<code class="docutils literal notranslate"><span class="pre">pose_hand</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">download_path</span></code>参数决定了预训练模型下载的路径。默认是下载到同级的checkpoints文件夹中，当代码运行时，会先在本地的同级目录中寻找是否有已下载的预训练模型，如果没有，到本地缓存中寻找，如果本地缓存没有，查看是不是指定了模型的路径，如果都没有，到网络下载。用户也可指定模型的下载路径，如<code class="docutils literal notranslate"><span class="pre">dowload_path='my_checkpoint'</span></code>。</p></li>
</ul>
</section>
<section id="id20">
<h4>2. 模型推理<a class="headerlink" href="#id20" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">keypoints</span><span class="p">,</span><span class="n">img_with_keypoints</span> <span class="o">=</span> <span class="n">hand</span><span class="o">.</span><span class="n">inference</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;data/hand.jpg&#39;</span><span class="p">,</span><span class="n">img_type</span><span class="o">=</span><span class="s1">&#39;pil&#39;</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># 进行模型推理</span>
</pre></div>
</div>
<p><img alt="../_images/hand_result.png" src="../_images/hand_result.png" /></p>
<p>模型推理<code class="docutils literal notranslate"><span class="pre">inference()</span></code>可传入参数：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">data</span></code>: 指定待识别关键点的图片，可以是以图片路径形式传入，也可直接传入cv2或pil格式的图片。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">show</span></code>: 可取值：<code class="docutils literal notranslate"><span class="pre">[True,False]</span></code> 默认为<code class="docutils literal notranslate"><span class="pre">False</span></code>。如果取值为<code class="docutils literal notranslate"><span class="pre">True</span></code>，在推理完成后会直接输出关键点识别完成后的图片。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">img_type</span></code>: 关键点识别完成后会返回含有关键点的图片，该参数指定了返回图片的格式，可选有:<code class="docutils literal notranslate"><span class="pre">['cv2','pil']</span></code>，默认值为<code class="docutils literal notranslate"><span class="pre">None</span></code>，如果不传入值，则不会返回图。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bbox</span></code>：该参数可配合目标检测使用。在多人手关键点检测中，该参数指定了要识别哪个检测框中的关键点。</p></li>
</ul>
<p>模型推理返回结果：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">keypoints</span></code>以二维数组的形式保存了所有关键点的坐标，每个关键点(x,y)被表示为<code class="docutils literal notranslate"><span class="pre">[x,y]</span></code>根据前面的图示，要获取到某个特定序号<code class="docutils literal notranslate"><span class="pre">i</span></code>的关键点，只需要访问<code class="docutils literal notranslate"><span class="pre">keypoints[i]</span></code>即可。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">img_with_keypoints</span></code>是个三维数组，以pil格式保存了关键点识别完成后的图片。</p></li>
</ul>
</section>
<section id="id21">
<h4>3. 结果输出<a class="headerlink" href="#id21" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">format_result</span> <span class="o">=</span> <span class="n">hand</span><span class="o">.</span><span class="n">format_output</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;zh&#39;</span><span class="p">)</span><span class="c1"># 将推理结果进行格式化输出</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">format_output()</span></code>能够将模型推理结果以标准美观的方式进行输出。输出结果与<code class="docutils literal notranslate"><span class="pre">format_result</span></code>保存的内容一致。参数<code class="docutils literal notranslate"><span class="pre">lang</span></code>设置了输出结果的语言，如果不指定默认为中文。</p>
<p><code class="docutils literal notranslate"><span class="pre">format_result</span></code>以字典形式存储了推理结果，共有两个键：<code class="docutils literal notranslate"><span class="pre">关键点坐标</span></code>和<code class="docutils literal notranslate"><span class="pre">分数</span></code>。关键点坐标以二维数组形式保存了每个关键点的[x,y]坐标，而分数则是对应下标的关键点的分数，以一维数组形式保存。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">hand</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">img_with_keypoints</span><span class="p">)</span><span class="c1"># 展示推理图片</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">show()</span></code>能够输出带有关键点的结果图像。</p>
<p><img alt="../_images/hand_show.png" src="../_images/hand_show.png" /></p>
</section>
<section id="id22">
<h4>4. 结果保存<a class="headerlink" href="#id22" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">hand</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">img_with_keypoints</span><span class="p">,</span><span class="s1">&#39;img_with_keypoints.jpg&#39;</span><span class="p">)</span><span class="c1"># 保存推理图片</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">save()</span></code>方法能够保存带有关键点的图像</p>
<p>该方法接收两个参数，一个是图像数据，另一个是图像的保存路径。</p>
</section>
</section>
<section id="id23">
<h3><strong>人体所有关键点</strong><a class="headerlink" href="#id23" title="Permalink to this heading"></a></h3>
<p>XEduHub提供了识别人体所有关键点，包括人手、人脸和人体躯干部分关键点的模型：<code class="docutils literal notranslate"><span class="pre">pose_wholebody133</span></code>。具体关键点的序号及其分布如下图所示：</p>
<p><img alt="../_images/wholebody.png" src="../_images/wholebody.png" /></p>
<section id="id24">
<h4>代码样例<a class="headerlink" href="#id24" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">XEdu.hub</span> <span class="kn">import</span> <span class="n">Workflow</span> <span class="k">as</span> <span class="n">wf</span>
<span class="n">wholebody</span> <span class="o">=</span> <span class="n">wf</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s1">&#39;pose_wholebody&#39;</span><span class="p">)</span> <span class="c1"># 数字可省略，当省略时，默认为pose_wholebody133</span>
<span class="n">keypoints</span><span class="p">,</span><span class="n">img_with_keypoints</span> <span class="o">=</span> <span class="n">wholebody</span><span class="o">.</span><span class="n">inference</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;data/wholebody.jpg&#39;</span><span class="p">,</span><span class="n">img_type</span><span class="o">=</span><span class="s1">&#39;pil&#39;</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># 进行模型推理</span>
<span class="n">format_result</span> <span class="o">=</span> <span class="n">wholebody</span><span class="o">.</span><span class="n">format_output</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;zh&#39;</span><span class="p">)</span><span class="c1"># 将推理结果进行格式化输出</span>
<span class="n">wholebody</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">img_with_keypoints</span><span class="p">)</span><span class="c1"># 展示推理图片</span>
<span class="n">wholebody</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">img_with_keypoints</span><span class="p">,</span><span class="s1">&#39;img_with_keypoints.jpg&#39;</span><span class="p">)</span><span class="c1"># 保存推理图片</span>
</pre></div>
</div>
</section>
<section id="id25">
<h4>代码解释<a class="headerlink" href="#id25" title="Permalink to this heading"></a></h4>
</section>
<section id="id26">
<h4>1. 模型声明<a class="headerlink" href="#id26" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">XEdu.hub</span> <span class="kn">import</span> <span class="n">Workflow</span> <span class="k">as</span> <span class="n">wf</span>
<span class="n">wholebody</span> <span class="o">=</span> <span class="n">wf</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s1">&#39;pose_wholebody&#39;</span><span class="p">)</span> <span class="c1"># 数字可省略，当省略时，默认为pose_wholebody133</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">wf()</span></code>中共有两个参数可以设置</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">task</span></code>决定了使用哪个关键点识别模型，全身关键点提取模型为<code class="docutils literal notranslate"><span class="pre">pose_wholebody</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">download_path</span></code>参数决定了预训练模型下载的路径。默认是下载到同级的checkpoints文件夹中，当代码运行时，会先在本地的同级目录中寻找是否有已下载的预训练模型，如果没有，到本地缓存中寻找，如果本地缓存没有，查看是不是指定了模型的路径，如果都没有，到网络下载。用户也可指定模型的下载路径，如<code class="docutils literal notranslate"><span class="pre">dowload_path='my_checkpoint'</span></code>。</p></li>
</ul>
</section>
<section id="id27">
<h4>2. 模型推理<a class="headerlink" href="#id27" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">keypoints</span><span class="p">,</span><span class="n">img_with_keypoints</span> <span class="o">=</span> <span class="n">wholebody</span><span class="o">.</span><span class="n">inference</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;data/wholebody.jpg&#39;</span><span class="p">,</span><span class="n">img_type</span><span class="o">=</span><span class="s1">&#39;pil&#39;</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># 进行模型推理</span>
</pre></div>
</div>
<p><img alt="../_images/wholebody_result.png" src="../_images/wholebody_result.png" /></p>
<p>模型推理<code class="docutils literal notranslate"><span class="pre">inference()</span></code>可传入参数：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">data</span></code>: 指定待识别关键点的图片，可以是以图片路径形式传入，也可直接传入cv2或pil格式的图片。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">show</span></code>: 可取值：<code class="docutils literal notranslate"><span class="pre">[True,False]</span></code> 默认为<code class="docutils literal notranslate"><span class="pre">False</span></code>。如果取值为<code class="docutils literal notranslate"><span class="pre">True</span></code>，在推理完成后会直接输出关键点识别完成后的图片。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">img_type</span></code>: 关键点识别完成后会返回含有关键点的图片，该参数指定了返回图片的格式，可选有:<code class="docutils literal notranslate"><span class="pre">['cv2','pil']</span></code>，默认值为<code class="docutils literal notranslate"><span class="pre">None</span></code>，如果不传入值，则不会返回图。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bbox</span></code>：该参数可配合目标检测使用。在多人手关键点检测中，该参数指定了要识别哪个检测框中的关键点。</p></li>
</ul>
<p>模型推理返回结果：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">keypoints</span></code>以二维数组的形式保存了所有关键点的坐标，每个关键点(x,y)被表示为<code class="docutils literal notranslate"><span class="pre">[x,y]</span></code>根据前面的图示，要获取到某个特定序号<code class="docutils literal notranslate"><span class="pre">i</span></code>的关键点，只需要访问<code class="docutils literal notranslate"><span class="pre">keypoints[i]</span></code>即可。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">img_with_keypoints</span></code>是个三维数组，以pil格式保存了关键点识别完成后的图片。</p></li>
</ul>
</section>
<section id="id28">
<h4>3. 结果输出<a class="headerlink" href="#id28" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">format_result</span> <span class="o">=</span> <span class="n">wholebody</span><span class="o">.</span><span class="n">format_output</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;zh&#39;</span><span class="p">)</span><span class="c1"># 将推理结果进行格式化输出</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">format_output()</span></code>能够将模型推理结果以标准美观的方式进行输出。输出结果与<code class="docutils literal notranslate"><span class="pre">format_result</span></code>保存的内容一致。参数<code class="docutils literal notranslate"><span class="pre">lang</span></code>设置了输出结果的语言，如果不指定默认为中文。</p>
<p><code class="docutils literal notranslate"><span class="pre">format_result</span></code>以字典形式存储了推理结果，共有两个键：<code class="docutils literal notranslate"><span class="pre">关键点坐标</span></code>和<code class="docutils literal notranslate"><span class="pre">分数</span></code>。关键点坐标以二维数组形式保存了每个关键点的[x,y]坐标，而分数则是对应下标的关键点的分数，以一维数组形式保存。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">wholebody</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">img_with_keypoints</span><span class="p">)</span><span class="c1"># 展示推理图片</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">show()</span></code>能够输出带有关键点的结果图像。</p>
<p><img alt="../_images/wholebody_show.png" src="../_images/wholebody_show.png" /></p>
</section>
<section id="id29">
<h4>4. 结果保存<a class="headerlink" href="#id29" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">wholebody</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">img_with_keypoints</span><span class="p">,</span><span class="s1">&#39;img_with_keypoints.jpg&#39;</span><span class="p">)</span><span class="c1"># 保存推理图片</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">save()</span></code>方法能够保存带有关键点的图像</p>
<p>该方法接收两个参数，一个是图像数据，另一个是图像的保存路径。</p>
</section>
</section>
</section>
<section id="id30">
<h2>2. 目标检测<a class="headerlink" href="#id30" title="Permalink to this heading"></a></h2>
<p>目标检测是一种计算机视觉任务，其目标是在图像或视频中检测并定位物体的位置，并为每个物体分配类别标签。</p>
<p>实现目标检测通常包括特征提取、物体位置定位、物体类别分类等步骤。这一技术广泛应用于自动驾驶、安全监控、医学影像分析、图像搜索等各种领域，为实现自动化和智能化应用提供了关键支持。</p>
<p>XEduHub目标支持目标检测任务有：coco目标检测<code class="docutils literal notranslate"><span class="pre">det_coco</span></code>、人体检测<code class="docutils literal notranslate"><span class="pre">det_body</span></code>、人脸检测<code class="docutils literal notranslate"><span class="pre">det_face</span></code>和人手检测<code class="docutils literal notranslate"><span class="pre">det_hand</span></code>。</p>
<section id="coco">
<h3>coco目标检测<a class="headerlink" href="#coco" title="Permalink to this heading"></a></h3>
<p>COCO（Common Objects in Context）是一个用于目标检测和图像分割任务的广泛使用的数据集和评估基准。它是计算机视觉领域中最重要的数据集之一，在XEduHub中的该模型能够检测出80类coco数据集中的物体：<code class="docutils literal notranslate"><span class="pre">det_coco</span></code>。</p>
<p>若要查看coco目标检测中的所有类别可运行以下代码：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">wf</span><span class="o">.</span><span class="n">coco_class</span><span class="p">()</span>
</pre></div>
</div>
<section id="id31">
<h4>代码样例<a class="headerlink" href="#id31" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">XEdu.hub</span> <span class="kn">import</span> <span class="n">Workflow</span> <span class="k">as</span> <span class="n">wf</span>
<span class="n">det_coco</span> <span class="o">=</span> <span class="n">wf</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s1">&#39;det_coco&#39;</span><span class="p">)</span>
<span class="n">result</span><span class="p">,</span><span class="n">img_with_box</span> <span class="o">=</span> <span class="n">det_coco</span><span class="o">.</span><span class="n">inference</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;data/det_coco.jpg&#39;</span><span class="p">,</span><span class="n">img_type</span><span class="o">=</span><span class="s1">&#39;pil&#39;</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># 进行模型推理</span>
<span class="n">format_result</span> <span class="o">=</span> <span class="n">det_coco</span><span class="o">.</span><span class="n">format_output</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;zh&#39;</span><span class="p">)</span><span class="c1"># 将推理结果进行格式化输出</span>
<span class="n">det_coco</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">img_with_box</span><span class="p">)</span><span class="c1"># 展示推理图片</span>
<span class="n">det_coco</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">img_with_box</span><span class="p">,</span><span class="s1">&#39;img_with_box.jpg&#39;</span><span class="p">)</span><span class="c1"># 保存推理图片</span>
</pre></div>
</div>
</section>
<section id="id32">
<h4>代码解释<a class="headerlink" href="#id32" title="Permalink to this heading"></a></h4>
</section>
<section id="id33">
<h4>1. 模型声明<a class="headerlink" href="#id33" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">XEdu.hub</span> <span class="kn">import</span> <span class="n">Workflow</span> <span class="k">as</span> <span class="n">wf</span>
<span class="n">det_coco</span> <span class="o">=</span> <span class="n">wf</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s1">&#39;det_coco&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">wf()</span></code>中共有两个参数可以设置</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">task</span></code>决定了使用哪个检测模型，coco目标检测的模型为<code class="docutils literal notranslate"><span class="pre">det_coco</span></code>。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">download_path</span></code>参数决定了预训练模型下载的路径。默认是下载到同级的checkpoints文件夹中，当代码运行时，会先在本地的同级目录中寻找是否有已下载的预训练模型，如果没有，到本地缓存中寻找，如果本地缓存没有，查看是不是指定了模型的路径，如果都没有，到网络下载。用户也可指定模型的下载路径，如<code class="docutils literal notranslate"><span class="pre">dowload_path='my_checkpoint'</span></code>。</p></li>
</ul>
</section>
<section id="id34">
<h4>2. 模型推理<a class="headerlink" href="#id34" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="p">,</span><span class="n">img_with_box</span> <span class="o">=</span> <span class="n">det_coco</span><span class="o">.</span><span class="n">inference</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;data/det_coco.jpg&#39;</span><span class="p">,</span><span class="n">img_type</span><span class="o">=</span><span class="s1">&#39;pil&#39;</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># 进行模型推理</span>
</pre></div>
</div>
<p><img alt="../_images/det_coco_result.png" src="../_images/det_coco_result.png" /></p>
<p>模型推理<code class="docutils literal notranslate"><span class="pre">inference()</span></code>可传入参数：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">data</span></code>：指定待检测的图片。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">show</span></code>: 可取值：<code class="docutils literal notranslate"><span class="pre">[True,False]</span></code> 默认为<code class="docutils literal notranslate"><span class="pre">False</span></code>。如果取值为<code class="docutils literal notranslate"><span class="pre">True</span></code>，在推理完成后会直接输出目标检测完成后的图片。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">img_type</span></code>：目标检测完成后会返回含有检测框的图片，该参数指定了返回图片的格式，可选有:<code class="docutils literal notranslate"><span class="pre">['cv2','pil']</span></code>，默认值为<code class="docutils literal notranslate"><span class="pre">None</span></code>，如果不传入值，则不会返回图。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">target_class</span></code>：该参数在使用<code class="docutils literal notranslate"><span class="pre">cocodetect</span></code>的时候可以指定要检测的对象，如：<code class="docutils literal notranslate"><span class="pre">person</span></code>，<code class="docutils literal notranslate"><span class="pre">cake</span></code>等等。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">thr</span></code>: 设置检测框阈值，取值范围为<code class="docutils literal notranslate"><span class="pre">[0,1]</span></code>超过该阈值的检测框被视为有效检测框，进行显示。</p></li>
</ul>
<p>模型推理返回结果：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">result</span></code>：以二维数组的形式保存了检测框左上角顶点的(x,y)坐标以及检测框的宽度w和高度h（之所以是二维数组，是因为该模型能够检测多个物体，因此当检测到多个物体时，就会有多个[x,y,w,h]的一维数组，所以需要以二维数组形式保存），我们可以利用这四个数据计算出其他三个顶点的坐标。</p></li>
</ul>
<p><img alt="../_images/det_res.png" src="../_images/det_res.png" /></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">img_with_box：</span></code>：是个三维数组，以cv2格式保存了包含了检测框的图片。</p></li>
</ul>
</section>
<section id="id35">
<h4>3. 结果输出<a class="headerlink" href="#id35" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">format_result</span> <span class="o">=</span> <span class="n">det_coco</span><span class="o">.</span><span class="n">format_output</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;zh&#39;</span><span class="p">)</span><span class="c1"># 将推理结果进行格式化输出</span>
</pre></div>
</div>
<p><img alt="../_images/det_coco_format.png" src="../_images/det_coco_format.png" /></p>
<p><code class="docutils literal notranslate"><span class="pre">format_output()</span></code>能够将模型推理结果以标准美观的方式进行输出。输出结果与<code class="docutils literal notranslate"><span class="pre">format_result</span></code>保存的内容一致。参数<code class="docutils literal notranslate"><span class="pre">lang</span></code>设置了输出结果的语言，如果不指定默认为中文。</p>
<p><code class="docutils literal notranslate"><span class="pre">format_result</span></code>以字典形式存储了推理结果，共有三个键：<code class="docutils literal notranslate"><span class="pre">检测框</span></code>、<code class="docutils literal notranslate"><span class="pre">分数</span></code>和<code class="docutils literal notranslate"><span class="pre">类别</span></code>。检测框以二维数组形式保存了每个检测框的坐标信息[x,y,w,h]，而分数则是对应下标的检测框的置信度，以一维数组形式保存，类别则是检测框中对象所属的类别，以一维数组形式保存。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">det_coco</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">img_with_box</span><span class="p">)</span><span class="c1"># 展示推理图片</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">show()</span></code>能够输出带有检测框以及对应类别的结果图像。</p>
<p><img alt="../_images/det_coco_show.png" src="../_images/det_coco_show.png" /></p>
</section>
<section id="id36">
<h4>4. 结果保存<a class="headerlink" href="#id36" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">det_coco</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">img_with_box</span><span class="p">,</span><span class="s1">&#39;img_with_box.jpg&#39;</span><span class="p">)</span><span class="c1"># 保存推理图片</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">save()</span></code>方法能够保存带有检测框以及对应类别的图像</p>
<p>该方法接收两个参数，一个是图像数据，另一个是图像的保存路径。</p>
</section>
</section>
<section id="id37">
<h3>人体检测<a class="headerlink" href="#id37" title="Permalink to this heading"></a></h3>
<p>人体目标检测的任务是在图像或视频中检测和定位人体的位置，并为每个检测到的人体分配一个相应的类别标签。</p>
<p>XEduHub提供了进行人体目标检测的模型：<code class="docutils literal notranslate"><span class="pre">det_body</span></code>，该模型能够进行单人的人体目标检测。</p>
<section id="id38">
<h4>代码样例<a class="headerlink" href="#id38" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">XEdu.hub</span> <span class="kn">import</span> <span class="n">Workflow</span> <span class="k">as</span> <span class="n">wf</span>
<span class="n">det_body</span> <span class="o">=</span> <span class="n">wf</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s1">&#39;det_body&#39;</span><span class="p">)</span>
<span class="n">result</span><span class="p">,</span><span class="n">img_with_box</span> <span class="o">=</span> <span class="n">det_body</span><span class="o">.</span><span class="n">inference</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;data/det_body.jpg&#39;</span><span class="p">,</span><span class="n">img_type</span><span class="o">=</span><span class="s1">&#39;pil&#39;</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># 进行模型推理</span>
<span class="n">format_result</span> <span class="o">=</span> <span class="n">det_body</span><span class="o">.</span><span class="n">format_output</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;zh&#39;</span><span class="p">)</span><span class="c1"># 将推理结果进行格式化输出</span>
<span class="n">det_body</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">img_with_box</span><span class="p">)</span><span class="c1"># 展示推理图片</span>
<span class="n">det_body</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">img_with_box</span><span class="p">,</span><span class="s1">&#39;img_with_box.jpg&#39;</span><span class="p">)</span><span class="c1"># 保存推理图片</span>
</pre></div>
</div>
</section>
<section id="id39">
<h4>代码解释<a class="headerlink" href="#id39" title="Permalink to this heading"></a></h4>
</section>
<section id="id40">
<h4>1. 模型声明<a class="headerlink" href="#id40" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">XEdu.hub</span> <span class="kn">import</span> <span class="n">Workflow</span> <span class="k">as</span> <span class="n">wf</span>
<span class="n">det_body</span> <span class="o">=</span> <span class="n">wf</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s1">&#39;det_body&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">wf()</span></code>中共有两个参数可以设置</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">task</span></code>决定了使用哪个检测模型，人体目标检测模型为<code class="docutils literal notranslate"><span class="pre">det_body</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">download_path</span></code>参数决定了预训练模型下载的路径。默认是下载到同级的checkpoints文件夹中，当代码运行时，会先在本地的同级目录中寻找是否有已下载的预训练模型，如果没有，到本地缓存中寻找，如果本地缓存没有，查看是不是指定了模型的路径，如果都没有，到网络下载。用户也可指定模型的下载路径，如<code class="docutils literal notranslate"><span class="pre">dowload_path='my_checkpoint'</span></code>。</p></li>
</ul>
</section>
<section id="id41">
<h4>2. 模型推理<a class="headerlink" href="#id41" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="p">,</span><span class="n">img_with_box</span> <span class="o">=</span> <span class="n">det_body</span><span class="o">.</span><span class="n">inference</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;data/det_body.jpg&#39;</span><span class="p">,</span><span class="n">img_type</span><span class="o">=</span><span class="s1">&#39;pil&#39;</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># 进行模型推理</span>
</pre></div>
</div>
<p><img alt="../_images/det_result1.png" src="../_images/det_result1.png" /></p>
<p>模型推理<code class="docutils literal notranslate"><span class="pre">inference()</span></code>可传入参数：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">data</span></code>：指定待检测的图片。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">show</span></code>: 可取值：<code class="docutils literal notranslate"><span class="pre">[True,False]</span></code> 默认为<code class="docutils literal notranslate"><span class="pre">False</span></code>。如果取值为<code class="docutils literal notranslate"><span class="pre">True</span></code>，在推理完成后会直接输出目标检测完成后的图片。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">img_type</span></code>：目标检测完成后会返回含有检测框的图片，该参数指定了返回图片的格式，可选有:<code class="docutils literal notranslate"><span class="pre">['cv2','pil']</span></code>，默认值为<code class="docutils literal notranslate"><span class="pre">None</span></code>，如果不传入值，则不会返回图。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">thr</span></code>: 设置检测框阈值，取值范围为<code class="docutils literal notranslate"><span class="pre">[0,1]</span></code>超过该阈值的检测框被视为有效检测框，进行显示。</p></li>
</ul>
<p>模型推理返回结果：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">result</span></code>：以二维数组的形式保存了检测框左上角顶点的(x,y)坐标以及检测框的宽度w和高度h（之所以是二维数组，是因为该模型能够检测多个人体，因此当检测到多个人体时，就会有多个[x,y,w,h]的一维数组，所以需要以二维数组形式保存），我们可以利用这四个数据计算出其他三个顶点的坐标。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">img_with_box：</span></code>：是个三维数组，以cv2格式保存了包含了检测框的图片。</p></li>
</ul>
</section>
<section id="id42">
<h4>3. 结果输出<a class="headerlink" href="#id42" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">format_result</span> <span class="o">=</span> <span class="n">det_body</span><span class="o">.</span><span class="n">format_output</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;zh&#39;</span><span class="p">)</span><span class="c1"># 将推理结果进行格式化输出</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">format_output()</span></code>能够将模型推理结果以标准美观的方式进行输出。输出结果与<code class="docutils literal notranslate"><span class="pre">format_result</span></code>保存的内容一致。参数<code class="docutils literal notranslate"><span class="pre">lang</span></code>设置了输出结果的语言，如果不指定默认为中文。</p>
<p><code class="docutils literal notranslate"><span class="pre">format_result</span></code>以字典形式存储了推理结果，共有两个键：<code class="docutils literal notranslate"><span class="pre">检测框</span></code>、<code class="docutils literal notranslate"><span class="pre">分数</span></code>。检测框以二维数组形式保存了每个检测框的坐标信息[x,y,w,h]，而分数则是对应下标的检测框的置信度，以一维数组形式保存。</p>
<p><img alt="../_images/det_body_format.png" src="../_images/det_body_format.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">det_body</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">img_with_box</span><span class="p">)</span><span class="c1"># 展示推理图片</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">show()</span></code>能够输出带有检测框的结果图像。</p>
<p><img alt="../_images/det_body_show.png" src="../_images/det_body_show.png" /></p>
</section>
<section id="id43">
<h4>4. 结果保存<a class="headerlink" href="#id43" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">det_body</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">img_with_box</span><span class="p">,</span><span class="s1">&#39;img_with_box.jpg&#39;</span><span class="p">)</span><span class="c1"># 保存推理图片</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">save()</span></code>方法能够保存带有检测框的图像</p>
<p>该方法接收两个参数，一个是图像数据，另一个是图像的保存路径。</p>
</section>
</section>
<section id="id44">
<h3>脸部检测<a class="headerlink" href="#id44" title="Permalink to this heading"></a></h3>
<p>人脸检测指的是检测和定位一张图片中的人脸。XEduHub使用的是opencv的人脸检测模型，能够快速准确地检测出一张图片中所有的人脸。EduHub提供了进行人体目标检测的模型：<code class="docutils literal notranslate"><span class="pre">det_face</span></code>，能够快速准确地检测出图片中的所有人脸。</p>
<section id="id45">
<h4>代码样例<a class="headerlink" href="#id45" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">XEdu.hub</span> <span class="kn">import</span> <span class="n">Workflow</span> <span class="k">as</span> <span class="n">wf</span>
<span class="n">det_face</span> <span class="o">=</span> <span class="n">wf</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s1">&#39;det_face&#39;</span><span class="p">)</span>
<span class="n">result</span><span class="p">,</span><span class="n">img_with_box</span> <span class="o">=</span> <span class="n">det_face</span><span class="o">.</span><span class="n">inference</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;data/det_face.jpg&#39;</span><span class="p">,</span><span class="n">img_type</span><span class="o">=</span><span class="s1">&#39;pil&#39;</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># 进行模型推理</span>
<span class="n">format_result</span> <span class="o">=</span> <span class="n">det_face</span><span class="o">.</span><span class="n">format_output</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;zh&#39;</span><span class="p">)</span><span class="c1"># 将推理结果进行格式化输出</span>
<span class="n">det_face</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">img_with_box</span><span class="p">)</span><span class="c1"># 展示推理图片</span>
<span class="n">det_face</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">img_with_box</span><span class="p">,</span><span class="s1">&#39;img_with_box.jpg&#39;</span><span class="p">)</span><span class="c1"># 保存推理图片</span>
</pre></div>
</div>
</section>
<section id="id46">
<h4>代码解释<a class="headerlink" href="#id46" title="Permalink to this heading"></a></h4>
</section>
<section id="id47">
<h4>1. 模型声明<a class="headerlink" href="#id47" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">XEdu.hub</span> <span class="kn">import</span> <span class="n">Workflow</span> <span class="k">as</span> <span class="n">wf</span>
<span class="n">det_face</span> <span class="o">=</span> <span class="n">wf</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s1">&#39;det_face&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">wf()</span></code>中共有两个参数可以设置</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">task</span></code>决定了使用哪个检测模型，人脸目标检测模型为<code class="docutils literal notranslate"><span class="pre">det_face</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">download_path</span></code>参数决定了预训练模型下载的路径。默认是下载到同级的checkpoints文件夹中，当代码运行时，会先在本地的同级目录中寻找是否有已下载的预训练模型，如果没有，到本地缓存中寻找，如果本地缓存没有，查看是不是指定了模型的路径，如果都没有，到网络下载。用户也可指定模型的下载路径，如<code class="docutils literal notranslate"><span class="pre">dowload_path='my_checkpoint'</span></code>。</p></li>
</ul>
</section>
<section id="id48">
<h4>2. 模型推理<a class="headerlink" href="#id48" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="p">,</span><span class="n">img_with_box</span> <span class="o">=</span> <span class="n">det_face</span><span class="o">.</span><span class="n">inference</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;data/det_face.jpg&#39;</span><span class="p">,</span><span class="n">img_type</span><span class="o">=</span><span class="s1">&#39;pil&#39;</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># 进行模型推理</span>
</pre></div>
</div>
<p><img alt="../_images/det_face_result.png" src="../_images/det_face_result.png" /></p>
<p>模型推理<code class="docutils literal notranslate"><span class="pre">inference()</span></code>可传入参数：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">data</span></code>：指定待检测的图片。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">show</span></code>: 可取值：<code class="docutils literal notranslate"><span class="pre">[True,False]</span></code> 默认为<code class="docutils literal notranslate"><span class="pre">False</span></code>。如果取值为<code class="docutils literal notranslate"><span class="pre">True</span></code>，在推理完成后会直接输出目标检测完成后的图片。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">img_type</span></code>：目标检测完成后会返回含有检测框的图片，该参数指定了返回图片的格式，可选有:<code class="docutils literal notranslate"><span class="pre">['cv2','pil']</span></code>，默认值为<code class="docutils literal notranslate"><span class="pre">None</span></code>，如果不传入值，则不会返回图。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">thr</span></code>: 设置检测框阈值，取值范围为<code class="docutils literal notranslate"><span class="pre">[0,1]</span></code>超过该阈值的检测框被视为有效检测框，进行显示。</p></li>
</ul>
<p>模型推理返回结果：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">result</span></code>：以二维数组的形式保存了检测框左上角顶点的(x,y)坐标以及检测框的宽度w和高度h（之所以是二维数组，是因为该模型能够检测多个人脸，因此当检测到多个人脸时，就会有多个[x,y,w,h]的一维数组，所以需要以二维数组形式保存），我们可以利用这四个数据计算出其他三个顶点的坐标。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">img_with_box：</span></code>：是个三维数组，以cv2格式保存了包含了检测框的图片。</p></li>
</ul>
</section>
<section id="id49">
<h4>3. 结果输出<a class="headerlink" href="#id49" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">format_result</span> <span class="o">=</span> <span class="n">det_face</span><span class="o">.</span><span class="n">format_output</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;zh&#39;</span><span class="p">)</span><span class="c1"># 将推理结果进行格式化输出</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">format_output()</span></code>能够将模型推理结果以标准美观的方式进行输出。输出结果与<code class="docutils literal notranslate"><span class="pre">format_result</span></code>保存的内容一致。参数<code class="docutils literal notranslate"><span class="pre">lang</span></code>设置了输出结果的语言，如果不指定默认为中文。</p>
<p><code class="docutils literal notranslate"><span class="pre">format_result</span></code>以字典形式存储了推理结果，只有一个键：<code class="docutils literal notranslate"><span class="pre">检测框</span></code>、<code class="docutils literal notranslate"><span class="pre">分数</span></code>。检测框以二维数组形式保存了每个检测框的坐标信息[x,y,w,h]。需要注意的是由于使用的为opencv的人脸检测模型，因此在<code class="docutils literal notranslate"><span class="pre">format_output</span></code>时缺少了分数这一指标。</p>
<p><img alt="../_images/det_face_format.png" src="../_images/det_face_format.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">det_face</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">img_with_box</span><span class="p">)</span><span class="c1"># 展示推理图片</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">show()</span></code>能够输出带有检测框的结果图像。</p>
<p><img alt="../_images/det_face_show.png" src="../_images/det_face_show.png" /></p>
</section>
<section id="id50">
<h4>4. 结果保存<a class="headerlink" href="#id50" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">det_face</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">img_with_box</span><span class="p">,</span><span class="s1">&#39;img_with_box.jpg&#39;</span><span class="p">)</span><span class="c1"># 保存推理图片</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">save()</span></code>方法能够保存带有检测框的图像</p>
<p>该方法接收两个参数，一个是图像数据，另一个是图像的保存路径。</p>
</section>
</section>
<section id="id51">
<h3>手部检测<a class="headerlink" href="#id51" title="Permalink to this heading"></a></h3>
<p>手部检测指的是检测和定位一张图片中的人手。XEduHub提供了进行人体目标检测的模型：<code class="docutils literal notranslate"><span class="pre">det_hand</span></code>，能够快速准确地检测出图片中的所有人手。</p>
<section id="id52">
<h4>代码样例<a class="headerlink" href="#id52" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">XEdu.hub</span> <span class="kn">import</span> <span class="n">Workflow</span> <span class="k">as</span> <span class="n">wf</span>
<span class="n">det_hand</span> <span class="o">=</span> <span class="n">wf</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s1">&#39;det_hand&#39;</span><span class="p">)</span>
<span class="n">result</span><span class="p">,</span><span class="n">img_with_box</span> <span class="o">=</span> <span class="n">det_body</span><span class="o">.</span><span class="n">inference</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;data/det_hand.jpg&#39;</span><span class="p">,</span><span class="n">img_type</span><span class="o">=</span><span class="s1">&#39;pil&#39;</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># 进行模型推理</span>
<span class="n">format_result</span> <span class="o">=</span> <span class="n">det_hand</span><span class="o">.</span><span class="n">format_output</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;zh&#39;</span><span class="p">)</span><span class="c1"># 将推理结果进行格式化输出</span>
<span class="n">det_hand</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">img_with_box</span><span class="p">)</span><span class="c1"># 展示推理图片</span>
<span class="n">det_hand</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">img_with_box</span><span class="p">,</span><span class="s1">&#39;img_with_box.jpg&#39;</span><span class="p">)</span><span class="c1"># 保存推理图片</span>
</pre></div>
</div>
</section>
<section id="id53">
<h4>代码解释<a class="headerlink" href="#id53" title="Permalink to this heading"></a></h4>
</section>
<section id="id54">
<h4>1. 模型声明<a class="headerlink" href="#id54" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">XEdu.hub</span> <span class="kn">import</span> <span class="n">Workflow</span> <span class="k">as</span> <span class="n">wf</span>
<span class="n">det_hand</span> <span class="o">=</span> <span class="n">wf</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s1">&#39;det_hand&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">wf()</span></code>中共有两个参数可以设置</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">task</span></code>决定了使用哪个检测模型，全身关键点提取模型为<code class="docutils literal notranslate"><span class="pre">det_face</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">download_path</span></code>参数决定了预训练模型下载的路径。默认是下载到同级的checkpoints文件夹中，当代码运行时，会先在本地的同级目录中寻找是否有已下载的预训练模型，如果没有，到本地缓存中寻找，如果本地缓存没有，查看是不是指定了模型的路径，如果都没有，到网络下载。用户也可指定模型的下载路径，如<code class="docutils literal notranslate"><span class="pre">dowload_path='my_checkpoint'</span></code>。</p></li>
</ul>
</section>
<section id="id55">
<h4>2. 模型推理<a class="headerlink" href="#id55" title="Permalink to this heading"></a></h4>
<p><img alt="../_images/det_hand_result.png" src="../_images/det_hand_result.png" /></p>
<p>模型推理<code class="docutils literal notranslate"><span class="pre">inference()</span></code>可传入参数：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">data</span></code>：指定待检测的图片。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">show</span></code>: 可取值：<code class="docutils literal notranslate"><span class="pre">[True,False]</span></code> 默认为<code class="docutils literal notranslate"><span class="pre">False</span></code>。如果取值为<code class="docutils literal notranslate"><span class="pre">True</span></code>，在推理完成后会直接输出目标检测完成后的图片。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">img_type</span></code>：目标检测完成后会返回含有检测框的图片，该参数指定了返回图片的格式，可选有:<code class="docutils literal notranslate"><span class="pre">['cv2','pil']</span></code>，默认值为<code class="docutils literal notranslate"><span class="pre">None</span></code>，如果不传入值，则不会返回图。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">thr</span></code>: 设置检测框阈值，取值范围为<code class="docutils literal notranslate"><span class="pre">[0,1]</span></code>超过该阈值的检测框被视为有效检测框，进行显示。</p></li>
</ul>
<p>模型推理返回结果：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">result</span></code>：以二维数组的形式保存了检测框左上角顶点的(x,y)坐标以及检测框的宽度w和高度h（之所以是二维数组，是因为该模型能够检测多个人手，因此当检测到多个人手时，就会有多个[x,y,w,h]的一维数组，所以需要以二维数组形式保存），我们可以利用这四个数据计算出其他三个顶点的坐标。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">img_with_box：</span></code>：是个三维数组，以cv2格式保存了包含了检测框的图片。</p></li>
</ul>
</section>
<section id="id56">
<h4>3. 结果输出<a class="headerlink" href="#id56" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">format_result</span> <span class="o">=</span> <span class="n">det_hand</span><span class="o">.</span><span class="n">format_output</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;zh&#39;</span><span class="p">)</span><span class="c1"># 将推理结果进行格式化输出</span>
</pre></div>
</div>
<p><img alt="../_images/det_hand_format.png" src="../_images/det_hand_format.png" /></p>
<p><code class="docutils literal notranslate"><span class="pre">format_output()</span></code>能够将模型推理结果以标准美观的方式进行输出。输出结果与<code class="docutils literal notranslate"><span class="pre">format_result</span></code>保存的内容一致。参数<code class="docutils literal notranslate"><span class="pre">lang</span></code>设置了输出结果的语言，如果不指定默认为中文。</p>
<p><code class="docutils literal notranslate"><span class="pre">format_result</span></code>以字典形式存储了推理结果，共有两个键：<code class="docutils literal notranslate"><span class="pre">检测框</span></code>、<code class="docutils literal notranslate"><span class="pre">分数</span></code>。检测框以二维数组形式保存了每个检测框的坐标信息[x,y,w,h]，而分数则是对应下标的检测框的置信度，以一维数组形式保存。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">det_hand</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">img_with_box</span><span class="p">)</span><span class="c1"># 展示推理图片</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">show()</span></code>能够输出带有检测框的结果图像。</p>
<p><img alt="../_images/det_hand_show.png" src="../_images/det_hand_show.png" /></p>
</section>
<section id="id57">
<h4>4. 结果保存<a class="headerlink" href="#id57" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">det_hand</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">img_with_box</span><span class="p">,</span><span class="s1">&#39;img_with_box.jpg&#39;</span><span class="p">)</span><span class="c1"># 保存推理图片</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">save()</span></code>方法能够保存带有检测框的图像</p>
<p>该方法接收两个参数，一个是图像数据，另一个是图像的保存路径。</p>
</section>
</section>
</section>
<section id="id58">
<h2>3. 图像分类<a class="headerlink" href="#id58" title="Permalink to this heading"></a></h2>
<p>图像分类是一个分类任务，它能够将不同的图像划分到指定的类别中，实现最小的分类误差和最高精度。XEduHub提供了进行图像分类的模型：<code class="docutils literal notranslate"><span class="pre">cls_imagenet</span></code>，该模型的分类类别取自ImageNet的一千个分类，这意味着该模型能够将输入的图像划分到这一千个分类中的类别上。</p>
<section id="id59">
<h3>代码样例<a class="headerlink" href="#id59" title="Permalink to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">XEdu.hub</span> <span class="kn">import</span> <span class="n">Workflow</span> <span class="k">as</span> <span class="n">wf</span>
<span class="bp">cls</span> <span class="o">=</span> <span class="n">wf</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s1">&#39;cls_imagenet&#39;</span><span class="p">)</span> <span class="c1"># 模型声明</span>
<span class="n">result</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">inference</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;data/cat101.jpg&#39;</span><span class="p">)</span><span class="c1"># 进行模型推理</span>
<span class="n">format_result</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">format_output</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;zh&#39;</span><span class="p">)</span><span class="c1">#推理结果格式化输出</span>
</pre></div>
</div>
</section>
<section id="id60">
<h3>代码解释<a class="headerlink" href="#id60" title="Permalink to this heading"></a></h3>
<section id="id61">
<h4>1. 模型声明<a class="headerlink" href="#id61" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">XEdu.hub</span> <span class="kn">import</span> <span class="n">Workflow</span> <span class="k">as</span> <span class="n">wf</span>
<span class="bp">cls</span> <span class="o">=</span> <span class="n">wf</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s2">&quot;cls_imagenet&quot;</span><span class="p">)</span> <span class="c1"># 模型声明</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">wf()</span></code>中共有两个参数可以设置</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">task</span></code>决定了进行图像分类的模型，目前支持<code class="docutils literal notranslate"><span class="pre">cls_imagenet</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">download_path</span></code>参数决定了预训练模型下载的路径。默认是下载到同级的checkpoints文件夹中，当代码运行时，会先在本地的同级目录中寻找是否有已下载的预训练模型，如果没有，到本地缓存中寻找，如果本地缓存没有，查看是不是指定了模型的路径，如果都没有，到网络下载。用户也可指定模型的下载路径，如<code class="docutils literal notranslate"><span class="pre">dowload_path='my_checkpoint'</span></code></p></li>
</ul>
</section>
<section id="id62">
<h4>2. 模型推理<a class="headerlink" href="#id62" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">inference</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;data/cat101.jpg&#39;</span><span class="p">)</span><span class="c1"># 进行模型推理</span>
</pre></div>
</div>
<p>模型推理<code class="docutils literal notranslate"><span class="pre">inference()</span></code>可传入参数：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">data</span></code>: 指定待分类的图片，可以是以图片路径形式传入，也可直接传入cv2或pil格式的图片。</p></li>
</ul>
<p>推理结果<code class="docutils literal notranslate"><span class="pre">result</span></code>是一个二维数组，表示这个图片在ImageNet的一千个分类中，属于每个分类的概率。</p>
<p><img alt="../_images/cls_result1.png" src="../_images/cls_result1.png" /></p>
</section>
<section id="id63">
<h4>3. 结果输出<a class="headerlink" href="#id63" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">format_result</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">format_output</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;zh&#39;</span><span class="p">)</span><span class="c1">#推理结果格式化输出</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">format_output()</span></code>能够将模型推理结果以标准美观的方式进行输出。输出结果与<code class="docutils literal notranslate"><span class="pre">format_result</span></code>保存的内容一致。</p>
<p><code class="docutils literal notranslate"><span class="pre">format_result</span></code>是一个字典，以格式化的方式展示了这张图片最有可能的分类结果。预测值表示图片分类标签在所有一千个分类中的索引，分数是属于这个分类的概率，预测类别是分类标签的内容。</p>
<p><img alt="../_images/cls_format.png" src="../_images/cls_format.png" /></p>
</section>
</section>
</section>
<section id="id64">
<h2>4. 风格迁移<a class="headerlink" href="#id64" title="Permalink to this heading"></a></h2>
<p>风格迁移，这里主要指的是图像风格迁移，指的是一种计算机视觉和图像处理技术。它允许将一个图像的艺术风格应用到另一个图像上，从而创建出一个新的图像，同时保留了原始图像的内容，但采用了第二个图像的风格。XEduHub提供了进行图像风格迁移的模型：<code class="docutils literal notranslate"><span class="pre">gen_style</span></code>，它预设了5种图像风格，并支持用户输入自定义的图片进行自定义风格迁移。</p>
<section id="id65">
<h3>代码样例<a class="headerlink" href="#id65" title="Permalink to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">XEdu.hub</span> <span class="kn">import</span> <span class="n">Workflow</span> <span class="k">as</span> <span class="n">wf</span>
<span class="n">style</span> <span class="o">=</span> <span class="n">wf</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s1">&#39;gen_style&#39;</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;mosaic&#39;</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">inference</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;data/cat101.jpg&#39;</span><span class="p">,</span><span class="n">img_type</span><span class="o">=</span><span class="s1">&#39;cv2&#39;</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="c1"># 进行模型推理</span>
<span class="n">style</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="c1"># 展示推理图片</span>
<span class="n">style</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="s2">&quot;style_cat.jpg&quot;</span><span class="p">)</span><span class="c1"># 保存推理图片</span>
</pre></div>
</div>
</section>
<section id="id66">
<h3>代码解释<a class="headerlink" href="#id66" title="Permalink to this heading"></a></h3>
<section id="id67">
<h4>1. 模型声明<a class="headerlink" href="#id67" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">XEdu.hub</span> <span class="kn">import</span> <span class="n">Workflow</span> <span class="k">as</span> <span class="n">wf</span>
<span class="n">style</span> <span class="o">=</span> <span class="n">wf</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s1">&#39;gen_style&#39;</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;mosaic&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">wf()</span></code>中共有三个参数可以设置</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">task</span></code>决定了任务类型</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">download_path</span></code>参数决定了预训练模型下载的路径。默认是下载到同级的checkpoints文件夹中，当代码运行时，会先在本地的同级目录中寻找是否有已下载的预训练模型，如果没有，到本地缓存中寻找，如果本地缓存没有，查看是不是指定了模型的路径，如果都没有，到网络下载。用户也可指定模型的下载路径，如<code class="docutils literal notranslate"><span class="pre">dowload_path='my_checkpoint'</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">style</span></code>决定了风格迁移所使用的风格。</p></li>
</ul>
<p>运行代码<code class="docutils literal notranslate"><span class="pre">wf.support_style()</span></code>可查看当前预设的风格。当前预设风格共有五种，如下图所示。</p>
<p><img alt="../_images/style_all.png" src="../_images/style_all.png" /></p>
<p><code class="docutils literal notranslate"><span class="pre">style</span></code>可选参数为：<code class="docutils literal notranslate"><span class="pre">['mosaic','candy','rain-princess','udnie','pointilism']</span></code>，也可以输入一张其他图片的路径来自定义风格，如<code class="docutils literal notranslate"><span class="pre">style='fangao.jpg'</span></code>。为了方便用户使用预设风格，还可以通过输入预设风格对应的标签值来进行设定，如<code class="docutils literal notranslate"><span class="pre">style=0</span></code>。</p>
<table class="docutils align-default">
    <thead>
        <tr class="row-odd">
            <th class="head">预设风格</th>
            <th class="head">对应标签值</th>
        </tr>
    </thead>
    <tbody>
        <tr class="row-even">
            <td>mosaic</td>
            <td>0</td>
        </tr>
        <tr class="row-even">
            <td>candy</td>
            <td>1</td>
        </tr>
        <tr class="row-even">
            <td>rain-princess</td>
            <td>2</td>
        </tr>
        <tr class="row-even">
            <td>udnie</td>
            <td>3</td>
        </tr>
        <tr class="row-even">
            <td>pointilism</td></td>
            <td>4</td>
        </tr>
    </tbody>
</table></section>
<section id="id68">
<h4>2. 模型推理<a class="headerlink" href="#id68" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">inference</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;data/cat101.jpg&#39;</span><span class="p">,</span><span class="n">img_type</span><span class="o">=</span><span class="s1">&#39;cv2&#39;</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="c1"># 进行模型推理</span>
</pre></div>
</div>
<p><img alt="../_images/style_result.png" src="../_images/style_result.png" /></p>
<p>模型推理<code class="docutils literal notranslate"><span class="pre">inference()</span></code>可传入参数：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">data</span></code>: 待进行风格迁移的图片，可以是以图片路径形式传入，也可直接传入cv2或pil格式的图片。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">show</span></code>: 可取值：<code class="docutils literal notranslate"><span class="pre">[true,false]</span></code> 默认为<code class="docutils literal notranslate"><span class="pre">false</span></code>。如果取值为<code class="docutils literal notranslate"><span class="pre">true</span></code>，在推理完成后会直接输出风格迁移完成后的图片。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">img_type</span></code>: 推理完成后会直接输出风格迁移完成后的图片。该参数指定了返回图片的格式，可选有:<code class="docutils literal notranslate"><span class="pre">['cv2','pil']</span></code>，默认值为<code class="docutils literal notranslate"><span class="pre">None</span></code>，如果不传入值，则不会返回图。</p></li>
</ul>
<p>模型推理返回结果：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">result</span></code>是个三维数组，以cv2格式保存了风格迁移完成后的图片。</p></li>
</ul>
</section>
<section id="id69">
<h4>3. 结果输出<a class="headerlink" href="#id69" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">style</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="c1"># 展示推理后的图片</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">show()</span></code>能够输出风格迁移后的结果图像。</p>
<p><img alt="../_images/style_show.png" src="../_images/style_show.png" /></p>
</section>
<section id="id70">
<h4>4. 结果保存<a class="headerlink" href="#id70" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">style</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="s2">&quot;style_cat.jpg&quot;</span><span class="p">)</span><span class="c1"># 保存推理图片</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">save()</span></code>方法能够保存风格迁移后的图像</p>
<p>该方法接收两个参数，一个是图像数据，另一个是图像的保存路径。</p>
</section>
</section>
</section>
<section id="ocr">
<h2>5. 光学字符识别（OCR）<a class="headerlink" href="#ocr" title="Permalink to this heading"></a></h2>
<p>光学字符识别（Optical Character Recognition, OCR）是一项用于将图像或扫描的文档转换为可编辑的文本格式的技术。OCR技术能够自动识别和提取图像或扫描文档中的文本，并将其转化为计算机可处理的文本格式。OCR技术在车牌识别、证件识别、文档扫描、拍照搜题等多个场景有着广泛应用。</p>
<p>XEduHub使用的OCR模型是来自百度的开源免费的OCR模型：rapidocr，这个模型运行速度快，性能优越，小巧灵活，并且能支持超过6000种字符的识别，如简体中文、繁体中文、英文、数字和其他艺术字等等。</p>
<p>注意：你可以在当前项目中找到名为<strong>font</strong>的文件夹，里面的FZVTK.TTF文件是一种字体文件，为了显示识别出的文字而使用。</p>
<section id="id71">
<h3>代码样例<a class="headerlink" href="#id71" title="Permalink to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">XEdu.hub</span> <span class="kn">import</span> <span class="n">Workflow</span> <span class="k">as</span> <span class="n">wf</span>
<span class="n">ocr</span> <span class="o">=</span> <span class="n">wf</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s2">&quot;ocr&quot;</span><span class="p">)</span>
<span class="n">result</span><span class="p">,</span><span class="n">ocr_img</span> <span class="o">=</span> <span class="n">ocr</span><span class="o">.</span><span class="n">inference</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;data/ocr_img.png&#39;</span><span class="p">,</span><span class="n">img_type</span><span class="o">=</span><span class="s1">&#39;cv2&#39;</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># 进行模型推理</span>
<span class="n">ocr_format_result</span> <span class="o">=</span> <span class="n">ocr</span><span class="o">.</span><span class="n">format_output</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s2">&quot;zh&quot;</span><span class="p">)</span><span class="c1"># 推理结果格式化输出</span>
<span class="n">ocr</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">ocr_img</span><span class="p">)</span><span class="c1"># 展示推理结果图片</span>
<span class="n">ocr</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">ocr_img</span><span class="p">,</span><span class="s1">&#39;ocr_result.jpg&#39;</span><span class="p">)</span><span class="c1"># 保存推理结果图片</span>
</pre></div>
</div>
</section>
<section id="id72">
<h3>代码解释<a class="headerlink" href="#id72" title="Permalink to this heading"></a></h3>
<section id="id73">
<h4>1. 模型声明<a class="headerlink" href="#id73" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">XEdu.hub</span> <span class="kn">import</span> <span class="n">Workflow</span> <span class="k">as</span> <span class="n">wf</span>
<span class="n">ocr</span> <span class="o">=</span> <span class="n">wf</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s2">&quot;ocr&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">wf()</span></code>中共有一个参数可以设置，这里的模型不是以onnx方式下载，而是以python库的形式下载和安装，因此不同于之前任务的下载方式，也无需指定下载路径。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">task</span></code>决定了任务类型</p></li>
</ul>
</section>
<section id="id74">
<h4>2. 模型推理<a class="headerlink" href="#id74" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="p">,</span><span class="n">ocr_img</span> <span class="o">=</span> <span class="n">ocr</span><span class="o">.</span><span class="n">inference</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;data/ocr_img.png&#39;</span><span class="p">,</span><span class="n">img_type</span><span class="o">=</span><span class="s1">&#39;cv2&#39;</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># 进行模型推理</span>
</pre></div>
</div>
<p><img alt="../_images/ocr_result.png" src="../_images/ocr_result.png" /></p>
<p>模型推理<code class="docutils literal notranslate"><span class="pre">inference()</span></code>可传入参数：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">data</span></code>: 指定待进行ocr的图片，可以是以图片路径形式传入，也可直接传入cv2或pil格式的图片。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">show</span></code>: 可取值：<code class="docutils literal notranslate"><span class="pre">[True,False]</span></code> 默认为<code class="docutils literal notranslate"><span class="pre">False</span></code>。如果取值为<code class="docutils literal notranslate"><span class="pre">True</span></code>，在推理完成后会直接输出OCR完成后的图片。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">img_type</span></code>：目标检测完成后会返回含有检测框的图片，该参数指定了返回图片的格式，可选有:<code class="docutils literal notranslate"><span class="pre">['cv2','pil']</span></code></p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">result</span></code>以一维数组的形式保存了识别出的文本及其检测框的四个顶点(x,y)坐标.</p>
<p>如图所示，数组中每个元素的形式为元组：（识别文本，检测框顶点坐标）。四个顶点坐标顺序分别为[左上，右上，左下，右下]。</p>
<p><img alt="../_images/ocr_res.png" src="../_images/ocr_res.png" /></p>
<p><code class="docutils literal notranslate"><span class="pre">ocr_img</span></code>的格式为cv2，保存了ocr识别后的结果图片。</p>
</section>
<section id="id75">
<h4>3. 结果输出<a class="headerlink" href="#id75" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ocr_format_result</span> <span class="o">=</span> <span class="n">ocr</span><span class="o">.</span><span class="n">format_output</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s2">&quot;zh&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="../_images/ocr_format.png" src="../_images/ocr_format.png" /></p>
<p><code class="docutils literal notranslate"><span class="pre">format_output()</span></code>能够将模型推理结果以标准美观的方式进行输出。输出结果与<code class="docutils literal notranslate"><span class="pre">format_result</span></code>保存的内容一致。参数<code class="docutils literal notranslate"><span class="pre">lang</span></code>设置了输出结果的语言，如果不指定默认为中文。</p>
<p><code class="docutils literal notranslate"><span class="pre">format_output</span></code>的结果以字典形式存储了推理结果，共有三个键：<code class="docutils literal notranslate"><span class="pre">检测框</span></code>、<code class="docutils literal notranslate"><span class="pre">分数</span></code>和<code class="docutils literal notranslate"><span class="pre">文本</span></code>。检测框以三维数组形式保存了每个检测框的四个顶点的[x,y]坐标，而分数则是对应下标的检测框分数，以一维数组形式保存。文本则是每个检测框中识别出的文本，以一维数组形式保存。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ocr</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">ocr_img</span><span class="p">)</span><span class="c1"># 展示推理结果图片</span>
</pre></div>
</div>
<p>显示结果图片：由两部分组成，左侧为原图片，右侧为经过ocr识别出的文本，并且该文本的位置与原图片中文本的位置保持对应。</p>
<p><img alt="../_images/ocr_show.png" src="../_images/ocr_show.png" /></p>
</section>
<section id="id76">
<h4>4. 结果保存<a class="headerlink" href="#id76" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ocr</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">ocr_img</span><span class="p">,</span><span class="s1">&#39;ocr_result.jpg&#39;</span><span class="p">)</span><span class="c1"># 保存推理结果图片</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">save()</span></code>方法能够保存ocr识别后的结果图像</p>
<p>该方法接收两个参数，一个是图像数据，另一个是图像的保存路径。</p>
</section>
</section>
</section>
<section id="id77">
<h2>6. 全景驾驶感知系统<a class="headerlink" href="#id77" title="Permalink to this heading"></a></h2>
<p>全景驾驶感知系统是一种高效的多任务学习网络，可同时执行交通对象检测、可行驶道路区域分割和车道检测任务，能很好地帮助自动驾驶汽车通过摄像头全面了解周围环境，来控制车辆的动作。那为什么我们需要多任务网络呢？这是因为在实时自动驾驶系统中为每个单独的任务运行单独的模型通常是不切实际的。多任务学习网络通过采用编码器-解码器模式提供了一种节省计算成本的潜在解决方案，编码器由不同的任务有效共享。XEduHub提供了进行全景驾驶感知的任务：<code class="docutils literal notranslate"><span class="pre">drive_perception</span></code>。</p>
<section id="id78">
<h3>代码样例<a class="headerlink" href="#id78" title="Permalink to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">XEdu.hub</span> <span class="kn">import</span> <span class="n">Workflow</span> <span class="k">as</span> <span class="n">wf</span>
<span class="n">drive</span> <span class="o">=</span> <span class="n">wf</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s1">&#39;drive_perception&#39;</span><span class="p">)</span> <span class="c1"># 实例化模型</span>
<span class="n">result</span><span class="p">,</span><span class="n">img</span> <span class="o">=</span> <span class="n">drive</span><span class="o">.</span><span class="n">inference</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s2">&quot;demo/drive.png&quot;</span><span class="p">,</span><span class="n">img_type</span><span class="o">=</span><span class="s1">&#39;cv2&#39;</span><span class="p">)</span> <span class="c1"># 模型推理</span>
<span class="n">drive</span><span class="o">.</span><span class="n">format_output</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;zh&#39;</span><span class="p">)</span> <span class="c1"># 将推理结果进行格式化输出</span>
<span class="n">drive</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">img</span><span class="p">)</span> <span class="c1"># 展示推理图片</span>
<span class="n">drive</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="s2">&quot;img_perception.jpg&quot;</span><span class="p">)</span> <span class="c1"># 保存推理图片</span>
</pre></div>
</div>
</section>
<section id="id79">
<h3>代码解释<a class="headerlink" href="#id79" title="Permalink to this heading"></a></h3>
<section id="id80">
<h4>1. 模型声明<a class="headerlink" href="#id80" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">XEdu.hub</span> <span class="kn">import</span> <span class="n">Workflow</span> <span class="k">as</span> <span class="n">wf</span>
<span class="n">drive</span> <span class="o">=</span> <span class="n">wf</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s1">&#39;drive_perception&#39;</span><span class="p">)</span> <span class="c1"># 实例化模型</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">wf()</span></code>中共有两个参数可以设置</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">task</span></code>决定了任务类型</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">download_path</span></code>参数决定了预训练模型下载的路径。默认是下载到同级的checkpoints文件夹中，当代码运行时，会先在本地的同级目录中寻找是否有已下载的预训练模型，如果没有，到本地缓存中寻找，如果本地缓存没有，查看是不是指定了模型的路径，如果都没有，到网络下载。用户也可指定模型的下载路径，如<code class="docutils literal notranslate"><span class="pre">dowload_path='my_checkpoint'</span></code></p></li>
</ul>
</section>
<section id="id81">
<h4>2. 模型推理<a class="headerlink" href="#id81" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="p">,</span><span class="n">img</span> <span class="o">=</span> <span class="n">drive</span><span class="o">.</span><span class="n">inference</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;demo/drive.png&#39;</span><span class="p">,</span><span class="n">img_type</span><span class="o">=</span><span class="s1">&#39;cv2&#39;</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># 模型推理</span>
</pre></div>
</div>
<p><img alt="../_images/drive_result.png" src="../_images/drive_result.png" /></p>
<p>模型推理<code class="docutils literal notranslate"><span class="pre">inference()</span></code>可传入参数：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">data</span></code>：指定待检测的图片。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">show</span></code>: 可取值：<code class="docutils literal notranslate"><span class="pre">[True,False]</span></code> 默认为<code class="docutils literal notranslate"><span class="pre">False</span></code>。如果取值为<code class="docutils literal notranslate"><span class="pre">True</span></code>，在推理完成后会直接输出目标检测完成后的图片。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">img_type</span></code>：目标检测完成后会返回含有检测框的图片，该参数指定了返回图片的格式，可选有:<code class="docutils literal notranslate"><span class="pre">['cv2','pil']</span></code>，默认值为<code class="docutils literal notranslate"><span class="pre">None</span></code>，如果不传入值，则不会返回图。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">thr</span></code>: 设置检测框阈值，取值范围为<code class="docutils literal notranslate"><span class="pre">[0,1]</span></code>超过该阈值的检测框被视为有效检测框，进行显示。</p></li>
</ul>
<p>模型推理返回结果：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">result</span></code>：以三维数组的形式保存了车辆检测（红色框），车道线分割（蓝色色块），可行驶区域（绿色色块）。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">车辆检测result[0]</span></code>：以二维数组保存了车辆目标检测框左上角顶点的(x,y)坐标以及检测框的宽度w和高度h（之所以是二维数组，是因为该模型能够检测多辆车，因此当检测到多辆车时，就会有多个[x,y,w,h]的一维数组，所以需要以二维数组形式保存），我们可以利用这四个数据计算出检测框的其他三个顶点的坐标。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">车道线分割result[1]</span></code>：以由0，1组成二维数组（w*h），保存图像中每个像素的mask，mask为1表示该像素为车道线分割目标，mask为0表示该像素是背景。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">可形式区域result[2]</span></code>：以由0，1组成二维数组（w*h），保存图像中每个像素的mask，mask为1表示该像素为可驾驶区域分割目标，mask为0表示该像素是背景。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">img_with_box：</span></code>：是个三维数组，以cv2格式保存了包含了检测框与分割目标的图片。</p></li>
</ul>
</section>
<section id="id82">
<h4>3. 结果输出<a class="headerlink" href="#id82" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">format_result</span> <span class="o">=</span> <span class="n">drive</span><span class="o">.</span><span class="n">format_output</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;zh&#39;</span><span class="p">)</span><span class="c1"># 将推理结果进行格式化输出</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">format_output()</span></code>能够将模型推理结果以标准美观的方式进行输出。输出结果与<code class="docutils literal notranslate"><span class="pre">format_result</span></code>保存的内容一致。参数<code class="docutils literal notranslate"><span class="pre">lang</span></code>设置了输出结果的语言，如果不指定默认为中文。</p>
<p><code class="docutils literal notranslate"><span class="pre">format_result</span></code>以字典形式存储了推理结果，有四个键：<code class="docutils literal notranslate"><span class="pre">检测框</span></code>、<code class="docutils literal notranslate"><span class="pre">分数</span></code>、<code class="docutils literal notranslate"><span class="pre">车道线掩码</span></code>、<code class="docutils literal notranslate"><span class="pre">可行驶区域掩码</span></code>。检测框以二维数组形式保存了每个检测框的坐标信息[x,y,w,h]。</p>
<p><img alt="../_images/drive_format.png" src="../_images/drive_format.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">drive</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">img</span><span class="p">)</span><span class="c1"># 展示推理图片</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">show()</span></code>能够输出带有检测框与分割目标的图片。</p>
<p><img alt="../_images/drive_show.png" src="../_images/drive_show.png" /></p>
</section>
<section id="id83">
<h4>4. 结果保存<a class="headerlink" href="#id83" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">drive</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="s2">&quot;img_perception.jpg&quot;</span><span class="p">)</span> <span class="c1"># 保存推理图片</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">save()</span></code>方法能够保存带有检测框与分割目标的图片。</p>
<p>该方法接收两个参数，一个是图像数据，另一个是图像的保存路径。</p>
</section>
</section>
</section>
<section id="mmedu">
<h2>7. MMEdu模型推理<a class="headerlink" href="#mmedu" title="Permalink to this heading"></a></h2>
<p>XEduHub现在可以支持使用MMEdu导出的onnx模型进行推理啦！如果你想了解如何使用MMEdu训练模型，可以看这里：<a class="reference external" href="https://xedu.readthedocs.io/zh/master/mmedu/mmclassification.html">解锁图像分类模块：MMClassification</a>、<a class="reference external" href="https://xedu.readthedocs.io/zh/master/mmedu/mmdetection.html">揭秘目标检测模块：MMDetection</a>。</p>
<p>如果你想了解如何将使用<a class="reference external" href="https://xedu.readthedocs.io/zh/master/mmedu.html">MMEdu</a>训练好的模型转换成ONNX格式，可以看这里<a class="reference external" href="https://xedu.readthedocs.io/zh/master/mmedu/model_convert.html">最后一步：AI模型转换</a>。OK，准备好了ONNX模型，那么就开始使用XEduHub吧！</p>
<section id="mmclassification">
<h3>MMClassification模型<a class="headerlink" href="#mmclassification" title="Permalink to this heading"></a></h3>
<section id="id84">
<h4>代码样例<a class="headerlink" href="#id84" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">XEdu.hub</span> <span class="kn">import</span> <span class="n">Workflow</span> <span class="k">as</span> <span class="n">wf</span>
<span class="n">mmcls</span> <span class="o">=</span> <span class="n">wf</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s1">&#39;mmedu&#39;</span><span class="p">,</span><span class="n">checkpoint</span><span class="o">=</span><span class="s1">&#39;cats_dogs.onnx&#39;</span><span class="p">)</span><span class="c1"># 指定使用的onnx模型</span>
<span class="n">result</span><span class="p">,</span> <span class="n">result_img</span> <span class="o">=</span>  <span class="n">mmcls</span><span class="o">.</span><span class="n">inference</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;data/cat101.jpg&#39;</span><span class="p">,</span><span class="n">img_type</span><span class="o">=</span><span class="s1">&#39;pil&#39;</span><span class="p">)</span><span class="c1"># 进行模型推理</span>
<span class="n">format_result</span> <span class="o">=</span> <span class="n">mmcls</span><span class="o">.</span><span class="n">format_output</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s2">&quot;zh&quot;</span><span class="p">)</span><span class="c1"># 推理结果格式化输出</span>
<span class="n">mmcls</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">result_img</span><span class="p">)</span><span class="c1"># 展示推理结果图片</span>
<span class="n">mmcls</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">result_img</span><span class="p">,</span><span class="s1">&#39;new_cat.jpg&#39;</span><span class="p">)</span><span class="c1"># 保存推理结果图片</span>
</pre></div>
</div>
</section>
<section id="id85">
<h4>代码解释<a class="headerlink" href="#id85" title="Permalink to this heading"></a></h4>
<section id="id86">
<h5>1. 模型声明<a class="headerlink" href="#id86" title="Permalink to this heading"></a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">XEdu.hub</span> <span class="kn">import</span> <span class="n">Workflow</span> <span class="k">as</span> <span class="n">wf</span>
<span class="n">mmcls</span> <span class="o">=</span> <span class="n">wf</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s1">&#39;mmedu&#39;</span><span class="p">,</span><span class="n">checkpoint</span><span class="o">=</span><span class="s1">&#39;cats_dogs.onnx&#39;</span><span class="p">)</span><span class="c1"># 指定使用的onnx模型</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">wf()</span></code>中共有两个参数可以设置</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">task</span></code>：只需要设置task为<code class="docutils literal notranslate"><span class="pre">mmedu</span></code> ，而不需要指定是哪种任务</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">checkpoint</span></code>：指定你的模型的路径</p></li>
</ul>
<p>这里我们以猫狗分类模型为例，项目指路：<a class="reference external" href="https://www.openinnolab.org.cn/pjlab/project?id=63c756ad2cf359369451a617&amp;sc=647b3880aac6f67c822a04f5#public">猫狗分类</a>。</p>
</section>
<section id="id87">
<h5>2. 模型推理<a class="headerlink" href="#id87" title="Permalink to this heading"></a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="p">,</span> <span class="n">result_img</span> <span class="o">=</span>  <span class="n">mmcls</span><span class="o">.</span><span class="n">inference</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;data/cat101.jpg&#39;</span><span class="p">,</span><span class="n">img_type</span><span class="o">=</span><span class="s1">&#39;pil&#39;</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="c1"># 进行模型推理</span>
</pre></div>
</div>
<p><img alt="../_images/mmcls_result.png" src="../_images/mmcls_result.png" /></p>
<p>模型推理<code class="docutils literal notranslate"><span class="pre">inference()</span></code>可传入参数：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">data</span></code>：指定待检测的图片。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">show</span></code>: 可取值：<code class="docutils literal notranslate"><span class="pre">[True,False]</span></code> 默认为<code class="docutils literal notranslate"><span class="pre">False</span></code>。如果取值为<code class="docutils literal notranslate"><span class="pre">True</span></code>，在推理完成后会直接输出目标检测完成后的图片。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">img_type</span></code>：分类完成后会返回含有分类标签的图片，该参数指定了返回图片的格式，可选有:<code class="docutils literal notranslate"><span class="pre">['cv2','pil']</span></code>，默认值为<code class="docutils literal notranslate"><span class="pre">None</span></code>，如果不传入值，则不会返回图。</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">result</span></code>是一个字典，包含三个键：<code class="docutils literal notranslate"><span class="pre">标签</span></code>、<code class="docutils literal notranslate"><span class="pre">置信度</span></code>和<code class="docutils literal notranslate"><span class="pre">预测结果</span></code>。显然，这张图片为猫的置信度接近100%，自然这张图片被分类为猫。</p>
<p><img alt="../_images/mmcls_res.png" src="../_images/mmcls_res.png" /></p>
<p><code class="docutils literal notranslate"><span class="pre">result_img</span></code>以pil格式保存了模型推理完成后的图片</p>
</section>
<section id="id88">
<h5>3. 结果输出<a class="headerlink" href="#id88" title="Permalink to this heading"></a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">format_result</span> <span class="o">=</span> <span class="n">mmcls</span><span class="o">.</span><span class="n">format_output</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s2">&quot;zh&quot;</span><span class="p">)</span><span class="c1"># 推理结果格式化输出</span>
</pre></div>
</div>
<p><img alt="../_images/mmcls_format.png" src="../_images/mmcls_format.png" /></p>
<p><code class="docutils literal notranslate"><span class="pre">format_output()</span></code>能够将模型推理结果以标准美观的方式进行输出。输出结果与<code class="docutils literal notranslate"><span class="pre">format_result</span></code>保存的内容一致。参数<code class="docutils literal notranslate"><span class="pre">lang</span></code>设置了输出结果的语言，如果不指定默认为中文。</p>
<p><code class="docutils literal notranslate"><span class="pre">format_result</span></code>以字典形式保存了模型的推理结果，包括所属<code class="docutils literal notranslate"><span class="pre">标签</span></code>、<code class="docutils literal notranslate"><span class="pre">置信度</span></code>、以及<code class="docutils literal notranslate"><span class="pre">预测结果</span></code>。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mmcls</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">result_img</span><span class="p">)</span><span class="c1"># 展示推理结果图片</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">show()</span></code>能够推理后的结果图像。与原图相比，结果图片在左上角多了<code class="docutils literal notranslate"><span class="pre">pred_label</span></code>, <code class="docutils literal notranslate"><span class="pre">pred_socre</span></code>和<code class="docutils literal notranslate"><span class="pre">pred_class</span></code>三个数据，对应着标签、置信度和预测结果。</p>
<p><img alt="../_images/mmcls_show.png" src="../_images/mmcls_show.png" /></p>
</section>
<section id="id89">
<h5>4. 结果保存<a class="headerlink" href="#id89" title="Permalink to this heading"></a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mmcls</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="s1">&#39;new_cat.jpg&#39;</span><span class="p">)</span><span class="c1"># 保存推理结果图片</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">save()</span></code>方法能够保存推理后的结果图像</p>
<p>该方法接收两个参数，一个是图像数据，另一个是图像的保存路径。</p>
</section>
</section>
</section>
<section id="mmdetection">
<h3>MMDetection模型<a class="headerlink" href="#mmdetection" title="Permalink to this heading"></a></h3>
<section id="id90">
<h4>代码样例<a class="headerlink" href="#id90" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">XEdu.hub</span> <span class="kn">import</span> <span class="n">Workflow</span> <span class="k">as</span> <span class="n">wf</span>
<span class="n">mmdet</span> <span class="o">=</span> <span class="n">wf</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s1">&#39;mmedu&#39;</span><span class="p">,</span><span class="n">checkpoint</span><span class="o">=</span><span class="s1">&#39;plate.onnx&#39;</span><span class="p">)</span><span class="c1"># 指定使用的onnx模型</span>
<span class="n">result</span><span class="p">,</span> <span class="n">result_img</span> <span class="o">=</span>  <span class="n">mmdet</span><span class="o">.</span><span class="n">inference</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;data/plate0.png&#39;</span><span class="p">,</span><span class="n">img_type</span><span class="o">=</span><span class="s1">&#39;pil&#39;</span><span class="p">)</span><span class="c1"># 进行模型推理</span>
<span class="n">format_result</span> <span class="o">=</span> <span class="n">mmdet</span><span class="o">.</span><span class="n">format_output</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s2">&quot;zh&quot;</span><span class="p">)</span><span class="c1"># 推理结果格式化输出</span>
<span class="n">mmdet</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">result_img</span><span class="p">)</span><span class="c1"># 展示推理结果图片</span>
<span class="n">mmdet</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">result_img</span><span class="p">,</span><span class="s1">&#39;new_plate.jpg&#39;</span><span class="p">)</span><span class="c1"># 保存推理结果图片</span>
</pre></div>
</div>
</section>
<section id="id91">
<h4>代码解释<a class="headerlink" href="#id91" title="Permalink to this heading"></a></h4>
<section id="id92">
<h5>1. 模型声明<a class="headerlink" href="#id92" title="Permalink to this heading"></a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">XEdu.hub</span> <span class="kn">import</span> <span class="n">Workflow</span> <span class="k">as</span> <span class="n">wf</span>
<span class="n">mmdet</span> <span class="o">=</span> <span class="n">wf</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s1">&#39;mmedu&#39;</span><span class="p">,</span><span class="n">checkpoint</span><span class="o">=</span><span class="s1">&#39;plate.onnx&#39;</span><span class="p">)</span><span class="c1"># 指定使用的onnx模型</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">wf()</span></code>中共有两个参数可以设置</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">task</span></code>：只需要设置task为<code class="docutils literal notranslate"><span class="pre">mmedu</span></code> ，而不需要指定是哪种任务</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">checkpoint</span></code>：指定你的模型的路径</p></li>
</ul>
<p>这里以车牌识别为例进行说明。项目指路：<a class="reference external" href="https://www.openinnolab.org.cn/pjlab/project?id=641426fdcb63f030544017a2&amp;backpath=/pjlab/projects/list#public">使用MMEdu实现车牌检测</a></p>
</section>
<section id="id93">
<h5>2. 模型推理<a class="headerlink" href="#id93" title="Permalink to this heading"></a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="p">,</span> <span class="n">result_img</span> <span class="o">=</span>  <span class="n">mmdet</span><span class="o">.</span><span class="n">inference</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;data/plate0.png&#39;</span><span class="p">,</span><span class="n">img_type</span><span class="o">=</span><span class="s1">&#39;pil&#39;</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="c1"># 进行模型推理</span>
</pre></div>
</div>
<p><img alt="../_images/mmdet_result.png" src="../_images/mmdet_result.png" /></p>
<p>模型推理<code class="docutils literal notranslate"><span class="pre">inference()</span></code>可传入参数：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">data</span></code>：指定待检测的图片。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">show</span></code>: 可取值：<code class="docutils literal notranslate"><span class="pre">[True,False]</span></code> 默认为<code class="docutils literal notranslate"><span class="pre">False</span></code>。如果取值为<code class="docutils literal notranslate"><span class="pre">True</span></code>，在推理完成后会直接输出目标检测完成后的图片。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">img_type</span></code>：目标检测完成后会返回含有检测框的图片，该参数指定了返回图片的格式，可选有:<code class="docutils literal notranslate"><span class="pre">['cv2','pil']</span></code>，默认值为<code class="docutils literal notranslate"><span class="pre">None</span></code>，如果不传入值，则不会返回图。</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">result</span></code>的结果是一个数组，里面保存了结果字典。该字典有四个键：<code class="docutils literal notranslate"><span class="pre">标签</span></code>、<code class="docutils literal notranslate"><span class="pre">置信度</span></code>、<code class="docutils literal notranslate"><span class="pre">坐标</span></code>以及<code class="docutils literal notranslate"><span class="pre">预测结果</span></code>。其中坐标表示了检测框的两个顶点：左上(x1,y1)和右下(x2,y2)。</p>
<p><img alt="../_images/mmdet_res.png" src="../_images/mmdet_res.png" /></p>
<p><code class="docutils literal notranslate"><span class="pre">result_img</span></code>以pil格式保存了模型推理完成后的图片</p>
</section>
<section id="id94">
<h5>3. 结果输出<a class="headerlink" href="#id94" title="Permalink to this heading"></a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">format_result</span> <span class="o">=</span> <span class="n">mmdet</span><span class="o">.</span><span class="n">format_output</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s2">&quot;zh&quot;</span><span class="p">)</span><span class="c1"># 推理结果格式化输出</span>
</pre></div>
</div>
<p><img alt="../_images/mmdet_format.png" src="../_images/mmdet_format.png" /></p>
<p><code class="docutils literal notranslate"><span class="pre">format_output()</span></code>能够将模型推理结果以标准美观的方式进行输出。输出结果与<code class="docutils literal notranslate"><span class="pre">format_result</span></code>保存的内容一致。参数<code class="docutils literal notranslate"><span class="pre">lang</span></code>设置了输出结果的语言，如果不指定默认为中文。</p>
<p><code class="docutils literal notranslate"><span class="pre">format_output</span></code>的结果是一个数组，里面保存了结果字典。该字典有四个键：<code class="docutils literal notranslate"><span class="pre">标签</span></code>、<code class="docutils literal notranslate"><span class="pre">置信度</span></code>、<code class="docutils literal notranslate"><span class="pre">坐标</span></code>以及<code class="docutils literal notranslate"><span class="pre">预测结果</span></code>。其中坐标表示了检测框的两个顶点：左上(x1,y1)和右下(x2,y2)。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mmdet</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">result_img</span><span class="p">)</span><span class="c1"># 展示推理结果图片</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">show()</span></code>能够推理后的结果图像。与原图相比，结果图片还包含车牌周围的检测框以及结果信息。</p>
<p><img alt="../_images/mmdet_show.png" src="../_images/mmdet_show.png" /></p>
</section>
<section id="id95">
<h5>4. 结果保存<a class="headerlink" href="#id95" title="Permalink to this heading"></a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mmdet</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="s1">&#39;new_plate.jpg&#39;</span><span class="p">)</span><span class="c1"># 保存推理结果图片</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">save()</span></code>方法能够保存推理后的结果图像</p>
<p>该方法接收两个参数，一个是图像数据，另一个是图像的保存路径。</p>
</section>
</section>
</section>
</section>
<section id="basenn">
<h2>8. BaseNN模型推理<a class="headerlink" href="#basenn" title="Permalink to this heading"></a></h2>
<p>XEduHub现在可以支持使用BaseNN导出的onnx模型进行推理啦！如果你想了解如何将使用<a class="reference external" href="https://xedu.readthedocs.io/zh/master/basenn.html">BaseNN</a>训练好的模型转换成ONNX格式，可以看这里：<a class="reference external" href="https://xedu.readthedocs.io/zh/master/basenn/introduction.html#id29">BaseNN模型文件格式转换</a>。OK，准备好了ONNX模型，那么就开始使用XEduHub吧！</p>
<section id="id96">
<h3>代码样例<a class="headerlink" href="#id96" title="Permalink to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 使用BaseNN训练的手写数字识别模型进行推理</span>
<span class="kn">from</span> <span class="nn">XEdu.hub</span> <span class="kn">import</span> <span class="n">Workflow</span> <span class="k">as</span> <span class="n">wf</span>
<span class="n">basenn</span> <span class="o">=</span> <span class="n">wf</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s2">&quot;basenn&quot;</span><span class="p">,</span><span class="n">checkpoint</span><span class="o">=</span><span class="s2">&quot;basenn.onnx&quot;</span><span class="p">)</span><span class="c1"># 指定使用的onnx模型</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">inference</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;data/6.jpg&#39;</span><span class="p">)</span><span class="c1"># 进行模型推理</span>
<span class="n">format_result</span> <span class="o">=</span> <span class="n">basenn</span><span class="o">.</span><span class="n">format_output</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="id97">
<h3>代码解释<a class="headerlink" href="#id97" title="Permalink to this heading"></a></h3>
<section id="id98">
<h4>1. 模型声明<a class="headerlink" href="#id98" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">XEdu.hub</span> <span class="kn">import</span> <span class="n">Workflow</span> <span class="k">as</span> <span class="n">wf</span>
<span class="n">basenn</span> <span class="o">=</span> <span class="n">wf</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s2">&quot;basenn&quot;</span><span class="p">,</span><span class="n">checkpoint</span><span class="o">=</span><span class="s2">&quot;basenn.onnx&quot;</span><span class="p">)</span><span class="c1"># 指定使用的onnx模型</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">wf()</span></code>中共有两个参数可以设置</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">task</span></code>：只需要设置task为<code class="docutils literal notranslate"><span class="pre">basenn</span></code> ，而不需要指定是哪种任务</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">checkpoint</span></code>：指定你的模型的路径</p></li>
</ul>
</section>
<section id="id99">
<h4>2. 模型推理<a class="headerlink" href="#id99" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">inference</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;data/6.jpg&#39;</span><span class="p">)</span><span class="c1"># 进行模型推理</span>
</pre></div>
</div>
<p>模型推理<code class="docutils literal notranslate"><span class="pre">inference()</span></code>可传入参数：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">data</span></code>：指定待检测的图片。</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">result</span></code>的结果是一个二维数组，第一个元素表示这张图属于0-9的数字类别的概率，可以看到当为6时，概率接近，因此该手写数字是6。</p>
<p><img alt="../_images/basenn_res.png" src="../_images/basenn_res.png" /></p>
</section>
<section id="id100">
<h4>3. 结果输出<a class="headerlink" href="#id100" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">format_result</span> <span class="o">=</span> <span class="n">basenn</span><span class="o">.</span><span class="n">format_output</span><span class="p">()</span>
</pre></div>
</div>
<p><img alt="../_images/basenn_format.png" src="../_images/basenn_format.png" /></p>
<p><code class="docutils literal notranslate"><span class="pre">format_output()</span></code>能够将模型推理结果以标准美观的方式进行输出。输出结果与<code class="docutils literal notranslate"><span class="pre">format_result</span></code>保存的内容一致。参数<code class="docutils literal notranslate"><span class="pre">lang</span></code>设置了输出结果的语言，如果不指定默认为中文。</p>
<p><code class="docutils literal notranslate"><span class="pre">format_output</span></code>的结果是一个结果字典，这个字典的第一个元素有两个键，<code class="docutils literal notranslate"><span class="pre">预测值</span></code>、<code class="docutils literal notranslate"><span class="pre">分数</span></code>，代表着该手写数字的分类标签以及属于该分类标签的概率。</p>
</section>
</section>
</section>
<section id="baseml">
<h2>9. BaseML模型推理<a class="headerlink" href="#baseml" title="Permalink to this heading"></a></h2>
<p>XEduHub现在可以支持使用BaseML导出的pkl模型文件进行推理啦！如果你想了解如何将使用<a class="reference external" href="https://xedu.readthedocs.io/zh/master/baseml.html">BaseML</a>训练模型并保存成.pkl模型文件，可以看这里：<a class="reference external" href="https://xedu.readthedocs.io/zh/master/baseml/introduction.html#id10">BaseML模型保存</a>。OK，准备好了pkl模型，那么就开始使用XEduHub吧！</p>
<section id="id101">
<h3>代码样例<a class="headerlink" href="#id101" title="Permalink to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 使用BaseML训练的鸢尾花聚类模型推理</span>
<span class="kn">from</span> <span class="nn">XEdu.hub</span> <span class="kn">import</span> <span class="n">Workflow</span> <span class="k">as</span> <span class="n">wf</span>
<span class="n">baseml</span> <span class="o">=</span> <span class="n">wf</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s1">&#39;baseml&#39;</span><span class="p">,</span><span class="n">checkpoint</span><span class="o">=</span><span class="s1">&#39;baseml.pkl&#39;</span><span class="p">)</span><span class="c1"># 指定使用的pkl模型</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">5.1</span><span class="p">,</span><span class="mf">1.5</span><span class="p">],[</span><span class="mi">7</span><span class="p">,</span><span class="mf">4.7</span><span class="p">]]</span> <span class="c1"># 该项目中训练数据只有两维，因此推理时给出两维数据</span>
<span class="n">result</span><span class="o">=</span> <span class="n">baseml</span><span class="o">.</span><span class="n">inference</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span><span class="c1"># 进行模型推理</span>
<span class="n">format_output</span> <span class="o">=</span> <span class="n">baseml</span><span class="o">.</span><span class="n">format_output</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;zh&#39;</span><span class="p">)</span><span class="c1"># 推理结果格式化输出</span>
</pre></div>
</div>
</section>
<section id="id102">
<h3>代码解释<a class="headerlink" href="#id102" title="Permalink to this heading"></a></h3>
<section id="id103">
<h4>1. 模型声明<a class="headerlink" href="#id103" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">XEdu.hub</span> <span class="kn">import</span> <span class="n">Workflow</span> <span class="k">as</span> <span class="n">wf</span>
<span class="n">baseml</span> <span class="o">=</span> <span class="n">wf</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s1">&#39;baseml&#39;</span><span class="p">,</span><span class="n">checkpoint</span><span class="o">=</span><span class="s1">&#39;baseml.pkl&#39;</span><span class="p">)</span><span class="c1"># 指定使用的pkl模型</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">wf()</span></code>中共有两个参数可以设置</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">task</span></code>：只需要设置task为<code class="docutils literal notranslate"><span class="pre">baseml</span></code> ，而不需要指定是哪种任务</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">checkpoint</span></code>：指定你的模型的路径</p></li>
</ul>
</section>
<section id="id104">
<h4>2. 模型推理<a class="headerlink" href="#id104" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">5.1</span><span class="p">,</span><span class="mf">1.5</span><span class="p">],[</span><span class="mi">7</span><span class="p">,</span><span class="mf">4.7</span><span class="p">]]</span> <span class="c1"># 该项目中训练数据只有两维，因此推理时给出两维数据</span>
<span class="n">result</span><span class="o">=</span> <span class="n">baseml</span><span class="o">.</span><span class="n">inference</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span><span class="c1"># 进行模型推理</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">mmdet.inference</span></code>可传入参数：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">data</span></code>：指定待推理数据（数据类型和格式跟模型训练有关）。</p></li>
</ul>
<p>**注意！**基于BaseML模型推理结果不包含图片！因为大部分使用BaseML解决的任务只需要输出分类标签、文本或者数组数据等。</p>
<p><img alt="../_images/baseml_result.png" src="../_images/baseml_result.png" /></p>
</section>
<section id="id105">
<h4>3. 结果输出<a class="headerlink" href="#id105" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">format_output</span> <span class="o">=</span> <span class="n">baseml</span><span class="o">.</span><span class="n">format_output</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;zh&#39;</span><span class="p">)</span><span class="c1"># 推理结果格式化输出</span>
</pre></div>
</div>
<p><img alt="../_images/baseml_format.png" src="../_images/baseml_format.png" /></p>
<p><code class="docutils literal notranslate"><span class="pre">format_result</span></code>以字典形式保存了模型的推理结果，由于使用的是聚类模型，输出结果为这两个特征数据所对应的聚类标签。</p>
<p>如果此时你有冲动去使用BaseML完成模型训练到推理，再到转换与应用，快去下文学习<a class="reference external" href="https://xedu.readthedocs.io/zh/master/baseml.html">BaseML的相关使用</a>吧！</p>
</section>
</section>
</section>
<section id="onnx">
<h2>10. 其他onnx模型推理<a class="headerlink" href="#onnx" title="Permalink to this heading"></a></h2>
<p>XEduHub现在可以支持使用用户自定义的ONNX模型文件进行推理啦！这意味着你可以不仅仅使用MMEdu或者BaseNN训练模型并转换而成的ONNX模型文件进行推理，还可以使用其他各个地方的ONNX模型文件，但是有个<strong>重要的前提：你需要会使用这个模型，了解模型输入的训练数据以及模型的输出结果</strong>。OK，如果你已经做好了充足的准备，那么就开始使用XEduHub吧！</p>
<section id="id106">
<h3>代码样例<a class="headerlink" href="#id106" title="Permalink to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">XEdu.hub</span> <span class="kn">import</span> <span class="n">Workflow</span> <span class="k">as</span> <span class="n">wf</span>
<span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">custom</span> <span class="o">=</span> <span class="n">wf</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s2">&quot;custom&quot;</span><span class="p">,</span><span class="n">checkpoint</span><span class="o">=</span><span class="s2">&quot;custom.onnx&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">pre</span><span class="p">(</span><span class="n">path</span><span class="p">):</span> <span class="c1"># 输入数据（此处为文件路径）前处理的输入参数就是模型推理时的输入参数，这里是图片的路径</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    这个前处理方法实现了将待推理的图片读入并进行数字化，调整数据类型、增加维度、调整各维度的顺序。</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="c1"># 读取图像</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="c1"># 调整数据类型</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># 增加batch维</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="c1"># [batch,channel,width,height]</span>
    <span class="k">return</span> <span class="n">img</span> <span class="c1"># 输出前处理过的数据（此处为四维numpy数组）</span>

<span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="n">data</span><span class="p">):</span> <span class="c1"># 输入推理结果和前处理后的数据</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    这个后处理方法实现了获取并返回推理结果中置信度最大的类别标签。</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># 返回类别索引</span>
    <span class="k">return</span> <span class="n">res</span> <span class="c1"># 输出结果</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">custom</span><span class="o">.</span><span class="n">inference</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;det.jpg&#39;</span><span class="p">,</span><span class="n">preprocess</span><span class="o">=</span><span class="n">pre</span><span class="p">,</span><span class="n">postprocess</span><span class="o">=</span><span class="n">post</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id107">
<h3>代码解释<a class="headerlink" href="#id107" title="Permalink to this heading"></a></h3>
<section id="id108">
<h4>1. 模型声明<a class="headerlink" href="#id108" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">XEdu.hub</span> <span class="kn">import</span> <span class="n">Workflow</span> <span class="k">as</span> <span class="n">wf</span>
<span class="n">custom</span> <span class="o">=</span> <span class="n">wf</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s2">&quot;custom&quot;</span><span class="p">,</span><span class="n">checkpoint</span><span class="o">=</span><span class="s2">&quot;custom.onnx&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">wf()</span></code>中共有两个参数可以设置</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">task</span></code>：只需要设置task为<code class="docutils literal notranslate"><span class="pre">custom</span></code> ，而不需要指定是哪种任务</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">checkpoint</span></code>：指定你的模型的路径</p></li>
</ul>
</section>
<section id="id109">
<h4>2. 模型推理<a class="headerlink" href="#id109" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">custom</span> <span class="o">=</span> <span class="n">wf</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s2">&quot;custom&quot;</span><span class="p">,</span><span class="n">checkpoint</span><span class="o">=</span><span class="s2">&quot;custom.onnx&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">pre</span><span class="p">(</span><span class="n">path</span><span class="p">):</span> <span class="c1"># 输入数据（此处为文件路径）前处理的输入参数就是模型推理时的输入参数，这里是图片的路径</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    这个前处理方法实现了将待推理的图片读入并进行数字化，调整数据类型、增加维度、调整各维度的顺序。</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="c1"># 读取图像</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="c1"># 调整数据类型</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># 增加batch维</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="c1"># [batch,channel,width,height]</span>
    <span class="k">return</span> <span class="n">img</span> <span class="c1"># 输出前处理过的数据（此处为四维numpy数组）</span>

<span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="n">data</span><span class="p">):</span> <span class="c1"># 输入推理结果和前处理后的数据</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    这个后处理方法实现了获取并返回推理结果中置信度最大的类别标签。</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># 返回类别索引</span>
    <span class="k">return</span> <span class="n">res</span> <span class="c1"># 输出结果</span>
</pre></div>
</div>
<p>在这里，使用自定义的ONNX模型进行推理的时候，你需要自己的需求实现模型输入数据的前处理以及输出数据的后处理方法，确保在进行模型推理的正常运行。</p>
<p>举一个例子，如果你手中有一个onnx模型文件，这个模型是一个<strong>目标检测模型</strong>，在训练时的训练数据是将图片读入后进行数字化处理得到的<strong>numpy数组</strong>，那么你在使用XEduHub时，基于该模型进行推理之前，<strong>需要设计对应的前处理方法</strong>将图片进行数字化。</p>
<p>同样地，如果你的模型的输出结果是一个一维数组，里面包含了所有类别标签对应的置信度，那么如果你想要输出检测出来的最有可能的类别标签，你就<strong>需要设计后处理方法</strong>，使得输出的推理结果满足你的需要。</p>
<p>以上是前处理和后处理方法的代码示例，以前文提到的目标检测为例。</p>
<p>在定义好了前处理和后处理函数之后，就可以进行模型推理了！记得要传入前后处理函数的名称到模型参数中。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">custom</span><span class="o">.</span><span class="n">inference</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;det.jpg&#39;</span><span class="p">,</span><span class="n">preprocess</span><span class="o">=</span><span class="n">pre</span><span class="p">,</span><span class="n">postprocess</span><span class="o">=</span><span class="n">post</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="../_images/custom_result.png" src="../_images/custom_result.png" /></p>
<p>模型推理<code class="docutils literal notranslate"><span class="pre">inference()</span></code>可传入参数：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">data</span></code>：指定待检测的图片</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">preprocess</span></code>: 指定前处理函数</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">postprocess</span></code>：指定后处理函数</p></li>
</ul>
</section>
</section>
</section>
<section id="id110">
<h2>报错专栏<a class="headerlink" href="#id110" title="Permalink to this heading"></a></h2>
<p>你是否在使用XEduHub时遇到过报错？是否遇到ERROR时感到无所适从，甚至有点慌张？
没有关系！报错专栏将为你可能在使用过程中出现的错误提供解决方案！
这里收录着使用XEduHub中的常见报错并呈现对应的解决方案，如果你遇到了问题，查看这个专栏，找到类似报错，并且解决它！</p>
<p>正在努力收录中……敬请期待！</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="installation.html" class="btn btn-neutral float-left" title="XEduHub安装" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="projects.html" class="btn btn-neutral float-right" title="XEduHub项目案例集" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021-2023 OpenXLabEdu.All Rights Reserved.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>